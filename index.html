
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Drafts Previewer</title>
  <meta name="author" content="Your Name">

  
  <meta name="description" content="Topics What are Page Objects
When and why?
Different type of Page Objects
Acceptance test / feature specs
Refactoring
How?
Design Patterns?
Tell-Don &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://vis-kid.github.io/octopress_drafts_previewer/">
  <link href="/octopress_drafts_previewer/favicon.png" rel="icon">
  <link href="/octopress_drafts_previewer/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/octopress_drafts_previewer/atom.xml" rel="alternate" title="Drafts Previewer" type="application/atom+xml">
  <script src="/octopress_drafts_previewer/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="/javascripts/libs/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/octopress_drafts_previewer/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="//fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="//fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  

</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/octopress_drafts_previewer/">Drafts Previewer</a></h1>
  
    <h2>Simple way to share my drafts for feedback</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/octopress_drafts_previewer/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="https://www.google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="sitesearch" value="vis-kid.github.io/octopress_drafts_previewer">
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/octopress_drafts_previewer/">Blog</a></li>
  <li><a href="/octopress_drafts_previewer/blog/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div class="blog-index">
  
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/octopress_drafts_previewer/blog/2015/10/26/Page-Objects/">Ruby Page Objects for Capybara Connoisseurs</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2015-10-26T04:29:10+01:00'><span class='date'><span class='date-month'>Oct</span> <span class='date-day'>26</span><span class='date-suffix'>th</span>, <span class='date-year'>2015</span></span> <span class='time'>4:29 am</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p><img src="/octopress_drafts_previewer/images/Page_Objects/capybara_bigger.png"></p>

<h3>Topics</h3>

<ul>
<li>What are Page Objects</li>
<li>When and why?</li>
<li>Different type of Page Objects</li>
<li>Acceptance test / feature specs</li>
<li>Refactoring</li>
<li>How?</li>
<li>Design Patterns?</li>
<li><p>Tell-Don’t-Ask</p></li>
<li><h3>What are Page Objects?</h3></li>
</ul>


<p>I’ll give you the short answer first. Its a design pattern to encapsulate markup and page interactions—specifially to refactor your feature specs. Its a combination of a two very common refactoring techniques: <em>Extract class</em> and  <em>Extract method</em>—which don’t have to happen at the same time because you can gradually build up to extracting a whole class via a new Page Object.</p>

<p>This technique offers you to write high-level feature specs that are very expressive and DRY. In a way they are acceptance tests with application language. You might ask, aren’t specs written with Capybara already high-level and expressive? Sure, for a developers who write codes on a daily basis, Capybara specs read just fine. Are the DRY out of the box? Certainly not!</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">feature</span> <span class="s1">&#39;M assigns a mission&#39;</span> <span class="k">do</span>
</span><span class='line'>  <span class="n">scenario</span> <span class="s1">&#39;they see the foobar on the page&#39;</span> <span class="k">do</span>
</span><span class='line'>    <span class="n">visit</span> <span class="n">new_mission_path</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">click_on</span> <span class="s1">&#39;Create Mission&#39;</span>
</span><span class='line'>    <span class="n">fill_in</span> <span class="s1">&#39;Mission Name&#39;</span><span class="p">,</span>  <span class="ss">with</span><span class="p">:</span> <span class="s1">&#39;Top Secret Mission&#39;</span>
</span><span class='line'>    <span class="n">fill_in</span> <span class="s1">&#39;Agent&#39;</span><span class="p">,</span> <span class="ss">with</span><span class="p">:</span> <span class="s1">&#39;James Bond&#39;</span>
</span><span class='line'>    <span class="n">click_button</span> <span class="s1">&#39;Create Mission&#39;</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">expect</span><span class="p">(</span><span class="n">page</span><span class="p">)</span><span class="o">.</span><span class="n">to</span> <span class="n">have_css</span> <span class="s1">&#39;li.mission-name&#39;</span><span class="p">,</span> <span class="s1">&#39;Top Secret Mission&#39;</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>When you look at this example of such a feature spec, where do you see opportunities to make this read better and how could you extract information to avoid duplication? Also, is this high-level enough for easy modeling of user stories and for non-technical stakeholders to understand? In my mind, there are a couple of ways to improve this and to make everybody happy—developers who can avoid fiddling with the details of interacting with the DOM while applying OOP and other non-coding team members having no trouble jumping between user stories and these tests. The last point is nice to have for sure, but the most important benefits come mostly from making your DOM-interacting specs more robust.</p>

<p>Encapsulation is the key concept with Page Objects. When you write your feature specs you’ll benefit from a strategy to extract the behaviour that is driving through a test flow. For quality code you want to capture the interactions with particular sets of elements on your pages—especially if you stumble upon repeating patterns. As your application grows, you want / need an approach that avoids spreading that logic all over your specs.</p>

<p>”Well isn’t that overkill? Capybara reads just fine!” you say? Ask yourself:
Why wouldn’t you have all the HTML implementation details in one place while having more stable tests? Why shouldn’t UI interaction tests have the same quality as tests for application code? Do you really wanna stop there? Due to everyday changes, Capybara selectors introduce possible breakpoints. Let’s say a designer wants to change the text on a button. No biggie right, but do you want to adapt to that change in one central wrapper for that element in your specs or do you prefer to do that all over the place? I thought so!</p>

<p>There are many refactorings possible for your feature specs but Page Objects offer the cleanest abstractions for encapsulating user facing behaviour for pages or more complex flows. You don’t have to simulate the whole page(s) though—focus on the essential bits that are necessary for user flows. No need to overdo it!</p>

<ul>
<li><h3>Acceptance Tests / Feature Specs</h3></li>
</ul>


<p>Before we move on to the heart of the matter, I’d like to take a step back for people new to the whole testing business and clear up some of the lingo that is important in this context. People more familiar with TDD won’t miss much if they skip ahead.</p>

<p>What are we talking about here? Acceptance testing usually comes in at a later stage of projects to evaluate if you have been building something of value for your users, product owner, or whatever stakeholder. These tests are usually run by customers or your users. Its sort of a check if the requirements are being met or not. There is something like a pyramid for all sorts of testing layers and acceptance tests are near the very top. Because this process includes often non-technical folks, a high-level language for writing these tests is a valuable asset to communicate back and forth.</p>

<p>Feature specs on the other hand, are a bit lower in the testing food chain. A lot more high-level than unit tests which focus on the technial details and business logic of your models, feature specs describe flows on and in between your pages. Tools like <a href="http://jnicklas.github.io/capybara/">Capybara</a> help you to avoid doing this manually—meaning that you rarely have to open your browser to test stuff manually. With these kinds of tests we like to automate these tasks as much as possible and test drive the interaction through the browser while writing assertions against pages. Btw, you don’t use <strong>get</strong>, <strong>put</strong>, <strong>post</strong> or <strong>delete</strong> like with request specs.</p>

<p>Feature specs are very similar to acceptance tests—sometimes I feel the differences are too blurry to really care about the terminology. You write tests that exercise your whole application which often involves a multi-step flow of user actions. These tests show if your components work in harmony when they are brought together. In Ruby land, they are the main protagonist when we’re dealing with Page Objects. Feature specs themselves are already very expressive but they can be optimized and cleaned up by extracting their data, behaviour and markup into separate classes. I felt clearing up this blurry terminology will help you see that having Page Objects is a bit like doing acceptance level testing while writing feature specs.</p>

<h3>Capybara</h3>

<p>Maybe we should go over this really quickly as well. This library describes itself as an “Acceptance test framework for web applications”. You can simulate user interactions with your pages via a very powerful and convenient domain-specific language. In my personal opinion, RSpec paired with Capybara offers atm the best way to write your feature specs. It lets you visit pages, fill in forms, click on links and buttons, look for markup on your pages and you are able to easily combine all kinds of these commands to interact with your pages.</p>

<p>You basically can avoid opening the browser yourself to test this stuff manually most of the time—which is not only less elegant but also a lot more time consuming and error-prone. Without this tool, the process of “Outside-in-testing”–you drive your code from high-level tests down into your unit-level tests—would be a lot more painful and possibly therefore more neglected. In other words you start writing these feature tests which are based on your user stories and from there you go down the rabbit whole until your unit tests provide the coverage you need. After that, when your tests are green of course, the game starts anew and you go back up to continue with a fresh feature test.</p>

<ul>
<li><h3>How?</h3></li>
</ul>


<p>Let’s look at a simple example of a feature spec that lets M create classified missions that can be completed. In the markup, you have a list of missions and a successful completion creates an addtional <strong>li</strong> with the class <strong>completed</strong>. Straightforward stuff right?</p>

<p><strong>spec/features/m_creates_a_mission_spec.rb</strong></p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="nb">require</span> <span class="s1">&#39;rails_helper&#39;</span>
</span><span class='line'>
</span><span class='line'><span class="n">feature</span> <span class="s1">&#39;M creates mission&#39;</span> <span class="k">do</span>
</span><span class='line'>  <span class="n">scenario</span> <span class="s1">&#39;successfully&#39;</span> <span class="k">do</span>
</span><span class='line'>    <span class="n">sign_in_as</span> <span class="s1">&#39;M@mi6.com&#39;</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">create_classified_mission</span> <span class="s1">&#39;Project Moonraker&#39;</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">expect</span><span class="p">(</span><span class="n">page</span><span class="p">)</span><span class="o">.</span><span class="n">to</span> <span class="n">have_css</span> <span class="s1">&#39;ul.missions&#39;</span><span class="p">,</span> <span class="ss">text</span><span class="p">:</span> <span class="s1">&#39;Project Moonraker&#39;</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">create_classified_mission</span><span class="p">(</span><span class="n">mission_name</span><span class="p">)</span>
</span><span class='line'>    <span class="n">visit</span> <span class="n">missions_path</span>
</span><span class='line'>    <span class="n">click_on</span> <span class="s1">&#39;Create Mission&#39;</span>
</span><span class='line'>    <span class="n">fill_in</span>  <span class="s1">&#39;Mission Name&#39;</span><span class="p">,</span> <span class="ss">with</span><span class="p">:</span> <span class="n">mission_name</span>
</span><span class='line'>    <span class="n">click_on</span> <span class="s1">&#39;Submit&#39;</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">sign_in_as</span><span class="p">(</span><span class="n">email</span><span class="p">)</span>
</span><span class='line'>    <span class="n">visit</span> <span class="n">root_path</span>
</span><span class='line'>    <span class="n">fill_in</span>  <span class="s1">&#39;Email&#39;</span><span class="p">,</span> <span class="ss">with</span><span class="p">:</span> <span class="n">email</span>
</span><span class='line'>    <span class="n">click_on</span> <span class="s1">&#39;Submit&#39;</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p><strong>spec/features/agent_completes_a_mission_spec.rb</strong></p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="nb">require</span> <span class="s1">&#39;rails_helper&#39;</span>
</span><span class='line'>
</span><span class='line'><span class="n">feature</span> <span class="s1">&#39;Agent completes mission&#39;</span> <span class="k">do</span>
</span><span class='line'>  <span class="n">scenario</span> <span class="s1">&#39;successfully&#39;</span> <span class="k">do</span>
</span><span class='line'>    <span class="n">sign_in_as</span> <span class="s1">&#39;M@mi6.com&#39;</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">create_classified_mission</span> <span class="s1">&#39;Project Moonraker&#39;</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">within</span> <span class="s2">&quot;li:contains(&#39;Project Moonraker&#39;)&quot;</span> <span class="k">do</span>
</span><span class='line'>      <span class="n">click_on</span> <span class="s1">&#39;Mission completed&#39;</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">expect</span><span class="p">(</span><span class="n">page</span><span class="p">)</span><span class="o">.</span><span class="n">to</span> <span class="n">have_css</span> <span class="s1">&#39;ul.missions li.completed&#39;</span><span class="p">,</span> <span class="ss">text</span><span class="p">:</span> <span class="s1">&#39;Project Moonraker&#39;</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">create_classified_mission</span><span class="p">(</span><span class="n">mission_name</span><span class="p">)</span>
</span><span class='line'>    <span class="n">visit</span> <span class="n">missions_path</span>
</span><span class='line'>    <span class="n">click_on</span> <span class="s1">&#39;Create Mission&#39;</span>
</span><span class='line'>    <span class="n">fill_in</span>  <span class="s1">&#39;Mission Name&#39;</span><span class="p">,</span> <span class="ss">with</span><span class="p">:</span> <span class="n">mission_name</span>
</span><span class='line'>    <span class="n">click_on</span> <span class="s1">&#39;Submit&#39;</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">sign_in_as</span><span class="p">(</span><span class="n">email</span><span class="p">)</span>
</span><span class='line'>    <span class="n">visit</span> <span class="n">root_path</span>
</span><span class='line'>    <span class="n">fill_in</span>  <span class="s1">&#39;Email&#39;</span><span class="p">,</span> <span class="ss">with</span><span class="p">:</span> <span class="n">email</span>
</span><span class='line'>    <span class="n">click_on</span> <span class="s1">&#39;Submit&#39;</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>Although there are other ways of course to deal with stuff like <strong>sign_in_as</strong> and <strong>create_classified_mission</strong>, its easy to see how fast these things can start to suck. UI related specs often don’t get the OO treatment they need I think. They have the reputation of providing too little bang for the buck and of course developers are not most fond of times when they have to touch the markup much. In my mind, that makes it even more important to DRY these specs up and make it fun to deal with them by throwing in a couple of Ruby classes.</p>

<p>Let’s do a little magic trick where I hide the Page Objects implementation for now and only show you the end result applied to the feature specs above:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="nb">require</span> <span class="s1">&#39;rails_helper&#39;</span>
</span><span class='line'>
</span><span class='line'><span class="n">feature</span> <span class="s1">&#39;M creates mission&#39;</span> <span class="k">do</span>
</span><span class='line'>  <span class="n">scenario</span> <span class="s1">&#39;successfully&#39;</span> <span class="k">do</span>
</span><span class='line'>    <span class="n">sign_in_as</span> <span class="s1">&#39;M@mi6.com&#39;</span>
</span><span class='line'>    <span class="n">mission_page</span> <span class="o">=</span> <span class="no">Pages</span><span class="o">::</span><span class="no">Missions</span><span class="o">.</span><span class="n">new</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">mission_page</span><span class="o">.</span><span class="n">create_classified_mission</span> <span class="s1">&#39;Project Moonraker&#39;</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">expect</span><span class="p">(</span><span class="n">page</span><span class="p">)</span><span class="o">.</span><span class="n">to</span> <span class="n">have_mission_with_title</span> <span class="s1">&#39;Project Moonraker&#39;</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p><strong>spec/features/agent_completes_a_mission_spec.rb</strong></p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="nb">require</span> <span class="s1">&#39;rails_helper&#39;</span>
</span><span class='line'>
</span><span class='line'><span class="n">feature</span> <span class="s1">&#39;Agent completes mission&#39;</span> <span class="k">do</span>
</span><span class='line'>  <span class="n">scenario</span> <span class="s1">&#39;successfully&#39;</span> <span class="k">do</span>
</span><span class='line'>    <span class="n">sign_in_as</span> <span class="s1">&#39;M@mi6.com&#39;</span>
</span><span class='line'>    <span class="n">mission_page</span> <span class="o">=</span> <span class="no">Pages</span><span class="o">::</span><span class="no">Missions</span><span class="o">.</span><span class="n">new</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">mission_page</span><span class="o">.</span><span class="n">create_classified_mission</span> <span class="ss">title</span><span class="p">:</span> <span class="s1">&#39;Project Moonraker&#39;</span>
</span><span class='line'>    <span class="n">mission_page</span><span class="o">.</span><span class="n">mark_complete</span> <span class="s1">&#39;Project Moonraker&#39;</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">expect</span><span class="p">(</span><span class="n">page</span><span class="p">)</span><span class="o">.</span><span class="n">to</span> <span class="n">have_completed_mission_with_title</span> <span class="s1">&#39;Project Moonraker&#39;</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>Doesn’t this read a whole lot better? You basically create expressive wrapper methods on your Page Objects that deal with high-level concepts—instead of fiddling everywhere with the intestines of your markup all the time. You basically extract methods that do this kind of dirty work and that way <a href="https://en.wikipedia.org/wiki/Shotgun_surgery"><strong>Shotgun surgery</strong></a> is not your problem anymore. Put differently, you abstract away a lot of the noisy, down in the weeds DOM interacting code. Let’s take a look at the implementation:</p>

<p><strong>specs/support/features/pages/missions.rb</strong></p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">module</span> <span class="nn">Pages</span>
</span><span class='line'>  <span class="k">class</span> <span class="nc">Missions</span>
</span><span class='line'>    <span class="kp">include</span> <span class="no">Capybara</span><span class="o">::</span><span class="no">DSL</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">def</span> <span class="nf">create_classified_mission</span><span class="p">(</span><span class="n">mission_name</span><span class="p">)</span>
</span><span class='line'>      <span class="n">visit</span> <span class="n">missions_path</span>
</span><span class='line'>      <span class="n">click_on</span> <span class="s1">&#39;Create Mission&#39;</span>
</span><span class='line'>      <span class="n">fill_in</span>  <span class="s1">&#39;Mission Name&#39;</span><span class="p">,</span> <span class="ss">with</span><span class="p">:</span> <span class="n">mission_name</span>
</span><span class='line'>      <span class="n">click_on</span> <span class="s1">&#39;Submit&#39;</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">def</span> <span class="nf">mark_complete</span><span class="p">(</span><span class="n">mission_name</span><span class="p">)</span>
</span><span class='line'>      <span class="n">within</span> <span class="s2">&quot;li:contains(&#39;</span><span class="si">#{</span><span class="n">mission_name</span><span class="si">}</span><span class="s2">&#39;)&quot;</span> <span class="k">do</span>
</span><span class='line'>      <span class="n">click_on</span> <span class="s1">&#39;Mission completed&#39;</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">def</span> <span class="nf">has_mission_with_name?</span><span class="p">(</span><span class="n">mission_name</span><span class="p">)</span>
</span><span class='line'>      <span class="n">mission_list</span><span class="o">.</span><span class="n">has_css?</span> <span class="s1">&#39;li&#39;</span><span class="p">,</span> <span class="ss">text</span><span class="p">:</span> <span class="n">mission_name</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">def</span> <span class="nf">has_completed_mission_with_name?</span><span class="p">(</span><span class="n">mission_name</span><span class="p">)</span>
</span><span class='line'>      <span class="n">mission_list</span><span class="o">.</span><span class="n">has_css?</span> <span class="s1">&#39;li.completed&#39;</span><span class="p">,</span> <span class="ss">text</span><span class="p">:</span> <span class="n">mission_name</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="kp">private</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">mission_list</span> <span class="k">do</span>
</span><span class='line'>    <span class="n">find</span><span class="p">(</span><span class="s1">&#39;ul.missions&#39;</span><span class="p">)</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>What you see is plain old Ruby object—Page Objects are in essence very simple classes really. Normally you don’t instantiate Page Objects with data and you create mostly a language via the API that a user or a non-technical stakeholder on a team might use. When you think about naming your methods, I think its good advice to ask yourself the question: How would a user describe the flow or the action taken?</p>

<p>Btw, <strong>spec/support/features/pages</strong> is a solid place to store your Page Objects. I should also probably add that without including Capybara the music stops pretty fast.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="kp">include</span> <span class="no">Capybara</span><span class="o">::</span><span class="no">DSL</span>
</span></code></pre></td></tr></table></div></figure>


<p>If you’re curious what happened to the <strong>sign_in_as</strong> method, I extracted it into a module at <strong>spec/support/sign_in_helper.rb</strong> and told RSpec to include that module. This has nothing to do with Page Objects, but its a makes more sense to store functionality like sign in more globally accessible than via Page Objects.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">module</span> <span class="nn">SignInHelper</span>
</span><span class='line'>  <span class="k">def</span> <span class="nf">sign_in_as</span><span class="p">(</span><span class="n">email</span><span class="p">)</span>
</span><span class='line'>    <span class="n">visit</span> <span class="n">root_path</span>
</span><span class='line'>    <span class="n">fill_in</span> <span class="s1">&#39;Email&#39;</span><span class="p">,</span> <span class="ss">with</span><span class="p">:</span> <span class="n">email</span>
</span><span class='line'>    <span class="n">click_on</span> <span class="s1">&#39;Submit&#39;</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="no">RSpec</span><span class="o">.</span><span class="n">configure</span> <span class="k">do</span> <span class="o">|</span><span class="n">config</span><span class="o">|</span>
</span><span class='line'>  <span class="n">config</span><span class="o">.</span><span class="n">include</span> <span class="no">SignInHelper</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>Overall, its easy to see that we succeed with hiding away the Capybara specifics—like finding elements, clicking links etc—you need for your tests so that you can focus on the functionality and less on the actual structure of the markup which is now encapsulated in a Page Object—the DOM structure should be the least of your concerns when you test something as high-level as feature specs.</p>

<p>You probably wonder how these custom matchers work:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">def</span> <span class="nf">has_mission_with_name?</span><span class="p">(</span><span class="n">mission_name</span><span class="p">)</span>
</span><span class='line'>  <span class="o">.</span><span class="n">.</span><span class="o">.</span>
</span><span class='line'><span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="k">def</span> <span class="nf">has_completed_mission_with_name?</span><span class="p">(</span><span class="n">mission_name</span><span class="p">)</span>
</span><span class='line'>  <span class="o">.</span><span class="n">.</span><span class="o">.</span>
</span><span class='line'><span class="k">end</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="n">expect</span><span class="p">(</span><span class="n">page</span><span class="p">)</span><span class="o">.</span><span class="n">to</span> <span class="n">have_mission_with_name</span>
</span><span class='line'><span class="n">expect</span><span class="p">(</span><span class="n">page</span><span class="p">)</span><span class="o">.</span><span class="n">to</span> <span class="n">have_completed_mission_with_name</span>
</span></code></pre></td></tr></table></div></figure>


<p>RSpec generates these custom matchers based on predicate methods on your Page Objects. RSpec converts them by removing the <strong>?</strong> and changes <strong>has</strong> to <strong>have</strong>. Boom, matchers from scratch without much fuzz! A bit magic, I’ll give you that, but the good kind of wizardry I’d say.</p>

<h3>Attention!</h3>

<p>Setup stuff like factory data belongs in the specs and not in Page Objects. Also assertions are probably better placed outside of your Page Objects to achieve a separation of concerns. There are two differnt perspectives on the topic:</p>

<p>Advocates for putting assertions into Page Objects say it helps with avoiding duplication of assertions. You can provide better error messages and achieve a better “Tell, Don’t Ask” style. On the other hand, advocates for assertion-free Page Objects argue that its better to not mix responsibilities. Providing access to page data and assertion logic are two separate concerns and lead to bloated Page Objects when mixed. Page Object’s responsibility is access to the state of pages and assertion logic belongs to specs.</p>

<ul>
<li><h3>Page Objects Types</h3></li>
</ul>


<p><strong>Components</strong> represent the smallest units and are more focused—like a form object for example.</p>

<p><strong>Pages</strong> combine more of these components and are abstractions of a full page.</p>

<p><strong>Experiences</strong>, as you guessed by now, span the whole flow across potentially many different pages. They are more high-level. They focus on the flow the user experiences while they interact with various pages. A checkout flow which has a couple of steps is a good example to think about this.</p>

<ul>
<li><h3>When &amp; Why?</h3></li>
</ul>


<p>Its a good idea to apply this design pattern a little bit later in a project’s life cycle—when you have amassed a little bit of complexity in your feature specs and when you can identify repeating patterns like DOM structures or other commonalities that are consistent on your pages. So you probably shouldn’t start writing Page Objects right away. You approach these refactorings gradually when the complexity and size of your application / tests grow. Duplications and refactorings that need a better home through Page Objects will be easier to spot over time. My recommendation is to start with extracting methods in your feature specs locally first. Once they’ll hit critical mass, they’ll look like obvious candidates for further extraction and most of them will probably fit the profile for Page Objects. Start small, premature optimization leaves nasty bite marks!</p>

<ul>
<li><h3>Final Thoughts</h3></li>
</ul>


<p>Page Objects provide you the opportunity to write clearer specs that read better and are overall a lot more expressive because they are more high-level. Besides that, they offer a nice abstraction for everybody who likes to write OO code. They hide the specifics of the DOM and also enable you to have private methods that do the dirty work while being unexposed to the public API. Extracted methods in your feature specs don’t offer the same luxury. The API of Page Objects don’t need to share the nitty-gritty Capybare details</p>

<p>For all the scenarios when design implementations change, your descriptions of how your app should work doesn’t need to change when you use Page Objects—your feature specs are more focused with user level interactions and don’t care so much about the specifics of the DOM implementations. Since change is inevitable, Page Objects become critical when applications grow and also aid the understanding when the sheer size of the application means drastically increased complexity.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/octopress_drafts_previewer/blog/2015/10/20/Factory-Girl-Guide-02/">Factory Girl 201</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2015-10-20T05:29:10+02:00'><span class='date'><span class='date-month'>Oct</span> <span class='date-day'>20</span><span class='date-suffix'>th</span>, <span class='date-year'>2015</span></span> <span class='time'>5:29 am</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p><img src="/octopress_drafts_previewer/images/Factory-Girl-Guide/Factory_Guide_Association_cropped.png"></p>

<p>My second article about this popular and useful Ruby gem deals with a couple more nuanced topics that beginners don’t necessarily need to concern themselves right away when they get started. Again, I did my best to keep it newbie-accessible and explain every bit of lingo people new to TDD might stumble over.</p>

<h3>Topics</h3>

<ul>
<li>Traits</li>
<li>Aliases</li>
<li>Callbacks</li>
<li>Associations</li>
<li>Lazy attributes</li>
<li>Modifying factories</li>
<li>Transient attributes</li>
<li><p>Dependent attributes</p></li>
<li><h3>Dependent Attributes</h3></li>
</ul>


<p>If you need to use attribute values for composing other factory attributes on the fly Factory Girl has you covered. You just need to wrap the attribute value in a block and interpolate the attributes you need. These blocks have access to an <em>evaluator</em>—which is yielded to them—and which in turn has access to other attributes, even transient ones.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="no">FactoryGirl</span><span class="o">.</span><span class="n">define</span> <span class="k">do</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">factory</span> <span class="ss">:supervillain</span> <span class="k">do</span>
</span><span class='line'>    <span class="nb">name</span>       <span class="s1">&#39;Karl Stromberg&#39;</span>
</span><span class='line'>    <span class="n">passion</span>    <span class="s1">&#39;marine biology&#39;</span>
</span><span class='line'>    <span class="n">ambition</span>   <span class="s1">&#39;human extinction&#39;</span>
</span><span class='line'>    <span class="n">motivation</span> <span class="s1">&#39;save the oceans&#39;</span>
</span><span class='line'>    <span class="n">profile</span>    <span class="p">{</span> <span class="s2">&quot;</span><span class="si">#{</span><span class="nb">name</span><span class="si">}</span><span class="s2"> has a passion for </span><span class="si">#{</span><span class="n">passion</span><span class="si">}</span><span class="s2"> and aims to </span><span class="si">#{</span><span class="n">motivation</span><span class="si">}</span><span class="s2"> through </span><span class="si">#{</span><span class="n">ambition</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">}</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="n">villain</span> <span class="o">=</span> <span class="n">create</span><span class="p">(</span><span class="ss">:supervillain</span><span class="p">)</span>
</span><span class='line'><span class="n">villain</span><span class="o">.</span><span class="n">profile</span>
</span><span class='line'><span class="c1"># =&gt; &quot;Karl Stromberg has a passion for marine biology and aims to save the oceans through human extinction.&quot;</span>
</span></code></pre></td></tr></table></div></figure>


<ul>
<li><h3>Transient Attributes</h3></li>
</ul>


<p>I think its fair to call them fake attributes. These virtual attributes also allow you to pass addtional options when you construct your factory intances—via a hash of course. The instance itself won’t be affected by them since these attributes won’t be set on your factory object. On the other hand, Factory Girl treats transient attributes just like real ones. If you use <strong>attributes_for</strong>, they won’t show up though. <strong>Dependent attributes</strong> and <strong>Callbacks</strong> are able to access these fake attributes inside your factory. Overall, they are another strategy to keep your factories DRY.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="no">FactoryGirl</span><span class="o">.</span><span class="n">define</span> <span class="k">do</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">factory</span> <span class="ss">:supervillain</span> <span class="k">do</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">transient</span> <span class="k">do</span>
</span><span class='line'>      <span class="n">megalomaniac</span> <span class="kp">false</span>
</span><span class='line'>      <span class="n">cat_owner</span> <span class="kp">false</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>    <span class="nb">name</span>       <span class="s1">&#39;Karl Stromberg&#39;</span>
</span><span class='line'>    <span class="n">passion</span>    <span class="s1">&#39;marine biology&#39;</span>
</span><span class='line'>    <span class="n">ambition</span>   <span class="s1">&#39;human extinction&#39;</span>
</span><span class='line'>    <span class="n">motivation</span> <span class="p">{</span> <span class="s2">&quot;Building an underwater civilization</span><span class="si">#{</span><span class="s2">&quot; and saving the world&quot;</span> <span class="k">if</span> <span class="n">megalomaniac</span><span class="si">}</span><span class="s2">&quot;</span> <span class="p">}</span>
</span><span class='line'>    <span class="n">profile</span>    <span class="p">{</span> <span class="s2">&quot;Insane business tycoon</span><span class="si">#{</span><span class="s2">&quot; – friends with Blofeld&quot;</span> <span class="k">if</span> <span class="n">cat_owner</span><span class="si">}</span><span class="s2">&quot;</span> <span class="p">}</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="n">villain</span> <span class="o">=</span> <span class="n">create</span><span class="p">(</span><span class="ss">:supervillain</span><span class="p">)</span>
</span><span class='line'><span class="n">villain</span><span class="o">.</span><span class="n">profile</span>
</span><span class='line'><span class="c1"># =&gt; &quot;Insane business tycoon&quot;</span>
</span><span class='line'><span class="n">villain</span><span class="o">.</span><span class="n">motivation</span>
</span><span class='line'><span class="c1"># =&gt; &quot;Building an underwater civilization&quot;</span>
</span><span class='line'>
</span><span class='line'><span class="n">cat_friendly_villain</span> <span class="o">=</span> <span class="n">create</span><span class="p">(</span><span class="ss">:supervillain</span><span class="p">,</span> <span class="ss">cat_owner</span><span class="p">:</span> <span class="kp">true</span><span class="p">)</span>
</span><span class='line'><span class="n">cat_friendly_villain</span><span class="o">.</span><span class="n">profile</span>
</span><span class='line'><span class="c1"># =&gt; &quot;Insane business tycoon – friends with Blofeld&quot;</span>
</span><span class='line'>
</span><span class='line'><span class="n">narcissistic_villain</span> <span class="o">=</span> <span class="n">create</span><span class="p">(</span><span class="ss">:supervillain</span><span class="p">,</span> <span class="ss">megalomaniac</span><span class="p">:</span> <span class="kp">true</span><span class="p">)</span>
</span><span class='line'><span class="n">narcissistic_villain</span><span class="o">.</span><span class="n">motivation</span>
</span><span class='line'><span class="c1"># =&gt; &quot;Building an underwater civilization and saving the world&quot;</span>
</span></code></pre></td></tr></table></div></figure>


<p>The example above turns out to be a bit more DRY since there was no need to create separate factories for supervillains that want to save the world or are friends with Blofeld repectively. Transient attributes give you the flexibility to make all kinds of adjustments and avoid creating a host of ever so similar factories.</p>

<ul>
<li><h3>Lazy attributes</h3></li>
</ul>


<p>“Normal” attributes in Factory Girl are evaluated when the factory is defined. You usually provide static values as parameters to methods with the same name of your attributes. If you want to delay the evaluation until the last possible moment—when the instance gets instantiated—you will need to feed attributes their values via a code block. Associations and dynamically created values from objects like <strong>DateTime</strong> objects will be your most frequent customers for that lazy treatment.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="no">FactoryGirl</span><span class="o">.</span><span class="n">define</span> <span class="k">do</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">factory</span> <span class="ss">:exploding_device</span> <span class="k">do</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">transient</span> <span class="k">do</span>
</span><span class='line'>      <span class="n">countdown_seconds</span> <span class="mi">10</span><span class="o">*</span><span class="mi">60</span>
</span><span class='line'>      <span class="n">time_of_explosion</span> <span class="p">{</span> <span class="no">Time</span><span class="o">.</span><span class="n">now</span> <span class="o">+</span> <span class="n">countdown_seconds</span> <span class="p">}</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">time_of_explosion</span> <span class="p">{</span> <span class="s2">&quot;Exploding in </span><span class="si">#{</span><span class="n">countdown_seconds</span><span class="si">}</span><span class="s2"> seconds </span><span class="si">#{</span><span class="n">time_of_explosion</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;at %I:%M %p&quot;</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span> <span class="p">}</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="n">ticking_device</span> <span class="o">=</span> <span class="n">create</span><span class="p">(</span><span class="ss">:exploding_device</span><span class="p">)</span>
</span><span class='line'><span class="n">ticking_device</span><span class="o">.</span><span class="n">time_of_explosion</span>
</span><span class='line'><span class="c1"># =&gt; &quot;Exploding in 600 seconds at 11:53 PM&quot;</span>
</span></code></pre></td></tr></table></div></figure>


<ul>
<li><h3>Modifying Factories</h3></li>
</ul>


<p>Probably not a use case you’ll run into everyday but sometimes you inherit factories from other developers and you want to change them—in case you are using a TDD’d gem for example. If you feel the need to tweak these legacy factories to better fit your specific test scenarios you can modify them without creating new ones or using inheritance.</p>

<p>You do this via <strong>FactoryGirl.modify</strong> and it needs to be outside of that particular <strong>FactoryGirl.define</strong> block that you want to change. What you can’t do is modify <strong>sequence</strong> or <strong>trait</strong>—you can override attributes defined via <strong>trait</strong> though. Callbacks on the “original” factory also won’t be overridden. The callback in your <strong>Factory.modify</strong> block will just be run as next in line.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="no">FactoryGirl</span><span class="o">.</span><span class="n">define</span> <span class="k">do</span>
</span><span class='line'>  <span class="n">factory</span> <span class="ss">:spy</span> <span class="k">do</span>
</span><span class='line'>    <span class="nb">name</span>              <span class="s1">&#39;Marty McSpy&#39;</span>
</span><span class='line'>    <span class="n">skills</span>            <span class="s1">&#39;Espionage and infiltration&#39;</span>
</span><span class='line'>    <span class="n">deployment_status</span> <span class="s1">&#39;Preparing mission&#39;</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="no">FactoryGirl</span><span class="o">.</span><span class="n">modify</span> <span class="k">do</span>
</span><span class='line'>  <span class="n">sequence</span> <span class="ss">:mission_deployment</span> <span class="k">do</span> <span class="o">|</span><span class="n">number</span><span class="o">|</span>
</span><span class='line'>    <span class="s2">&quot;Mission </span><span class="si">#{</span><span class="n">number</span><span class="si">}</span><span class="s2"> at </span><span class="si">#{</span><span class="no">DateTime</span><span class="o">.</span><span class="n">now</span><span class="o">.</span><span class="n">to_formatted_s</span><span class="p">(</span><span class="ss">:short</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">factory</span> <span class="ss">:spy</span> <span class="k">do</span>
</span><span class='line'>    <span class="nb">name</span>            <span class="s1">&#39;James Bond&#39;</span>
</span><span class='line'>    <span class="n">skills</span>          <span class="s1">&#39;CQC and poker&#39;</span>
</span><span class='line'>    <span class="n">favorite_weapon</span> <span class="s1">&#39;Walther PPK&#39;</span>
</span><span class='line'>    <span class="n">body_count</span>      <span class="s1">&#39;Classified&#39;</span>
</span><span class='line'>    <span class="n">favorite_car</span>    <span class="s1">&#39;Aston Martin DB9&#39;</span>
</span><span class='line'>    <span class="n">deployment</span>      <span class="p">{</span> <span class="n">generate</span><span class="p">(</span><span class="ss">:mission_deployment</span><span class="p">)</span> <span class="p">}</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>In the example above we needed our spies to be a bit more “sophisticated” and use a better mechanism to handle deployment. I have seen examples where gem authors had to deal with time differently and where it was handy to modify factory objects by simply overriding stuff you need to tweak.</p>

<ul>
<li><h3>Callbacks</h3></li>
</ul>


<p>Callbacks allow you to inject some code at various moments in the life cycle of an object—like <strong>save</strong>, <strong>after_save</strong>, <strong>before_validation</strong> and so on. Rails for example offers a whole bunch of them and makes it pretty easy for novices to abuse this power. Keep in mind that callbacks that are not related to the persistance of objects are a known anti-pattern and its good advice to not cross that line. For example, it may seem convenient to use a callback after instantiating something like user to send emails or process some order but these kinds of things invite bugs and create ties that are unnecessarily harder to refactor. Maybe that was one of the reasons why Factory Girl “only” offers you five callback options to play with:</p>

<ul>
<li><p><strong>before(:create)</strong> executes a code block before your factory instance is saved. Activated when you use <strong>create(:some_object)</strong>.</p></li>
<li><p><strong>after(:create)</strong> executes a code block after your factory instance is saved. Activated when you use <strong>create(:some_object)</strong>.</p></li>
<li><p><strong>after(:build)</strong> executes a code block after your factory object has been built in memory. Activated when you use both <strong>build(:some_object)</strong> and <strong>create(:some_object)</strong>.</p></li>
<li><p><strong>after(:stub)</strong> executes a code block after your factory has created a stubbed object. Activated when you use <strong>build_stubbed(:some_object)</strong>.</p></li>
<li><p><strong>custom(:your_custom_callback)</strong> executes a custom callback without the need to prepend <strong>before</strong> or <strong>after</strong>.</p></li>
</ul>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="no">FactoryGirl</span><span class="o">.</span><span class="n">define</span> <span class="k">do</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">factory</span> <span class="ss">:mission</span> <span class="k">do</span>
</span><span class='line'>    <span class="n">objective</span>        <span class="s1">&#39;Stopping the bad dude&#39;</span>
</span><span class='line'>    <span class="n">provided_gadgets</span> <span class="s1">&#39;Mini submarine and shark gun&#39;</span>
</span><span class='line'>    <span class="n">after</span><span class="p">(</span><span class="ss">:build</span><span class="p">)</span>    <span class="p">{</span> <span class="n">assign_support_analyst</span> <span class="p">}</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<h4>Attention!</h4>

<p>Note that for all callback options, inside the callback blocks, you’ll have access to an instance of the factory via a block parameter. This will come in handy every once in a while, especially with assocations.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="no">FactoryGirl</span><span class="o">.</span><span class="n">define</span> <span class="k">do</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">factory</span> <span class="ss">:double_agent</span> <span class="k">do</span>
</span><span class='line'>    <span class="n">after</span><span class="p">(</span><span class="ss">:stub</span><span class="p">)</span> <span class="p">{</span> <span class="o">|</span><span class="n">double_agent</span><span class="o">|</span> <span class="n">assign_new_identity</span><span class="p">(</span><span class="n">double_agent</span><span class="p">)</span> <span class="p">}</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>Below a <strong>Ninja</strong> has a bunch of nasty throwing stars (shuriken) at his disposal. Since you have a <strong>ninja</strong> object in the callback you can easily assign the throwing star to belong to the Ninja. Take a peek at the section about <em>associations</em> if that example leaves you with a couple of question marks.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="no">FactoryGirl</span><span class="o">.</span><span class="n">define</span> <span class="k">do</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">factory</span> <span class="ss">:ninja</span> <span class="k">do</span>
</span><span class='line'>    <span class="nb">name</span> <span class="s2">&quot;Ra’s al Ghul&quot;</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">factory</span> <span class="ss">:ninja_with_shuriken</span> <span class="k">do</span>
</span><span class='line'>      <span class="n">transient</span> <span class="k">do</span>
</span><span class='line'>        <span class="n">number_of_shuriken</span> <span class="mi">10</span>
</span><span class='line'>      <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>      <span class="n">after</span><span class="p">(</span><span class="ss">:create</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">ninja</span><span class="p">,</span> <span class="n">evaluator</span><span class="o">|</span>
</span><span class='line'>        <span class="n">create_list</span><span class="p">(</span><span class="ss">:shuriken</span><span class="p">,</span> <span class="n">evaluator</span><span class="o">.</span><span class="n">number_of_shuriken</span><span class="p">,</span> <span class="ss">ninja</span><span class="p">:</span> <span class="n">ninja</span><span class="p">)</span>
</span><span class='line'>      <span class="k">end</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">factory</span> <span class="ss">:shuriken</span> <span class="k">do</span>
</span><span class='line'>    <span class="nb">name</span>             <span class="s1">&#39;Hira-shuriken&#39;</span>
</span><span class='line'>    <span class="n">number_of_spikes</span> <span class="s1">&#39;Four&#39;</span>
</span><span class='line'>    <span class="n">ninja</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="n">ninja</span> <span class="o">=</span> <span class="n">create</span><span class="p">(</span><span class="ss">:ninja</span><span class="p">)</span>
</span><span class='line'><span class="n">ninja</span><span class="o">.</span><span class="n">shurikens</span><span class="o">.</span><span class="n">length</span> <span class="c1"># =&gt; 0</span>
</span><span class='line'>
</span><span class='line'><span class="n">ninja</span> <span class="o">=</span> <span class="n">create</span><span class="p">(</span><span class="ss">:ninja_with_shuriken</span><span class="p">)</span>
</span><span class='line'><span class="n">ninja</span><span class="o">.</span><span class="n">shurikens</span><span class="o">.</span><span class="n">length</span> <span class="c1"># =&gt; 10</span>
</span><span class='line'>
</span><span class='line'><span class="n">ninja</span> <span class="o">=</span> <span class="n">create</span><span class="p">(</span><span class="ss">:ninja_with_shuriken</span><span class="p">,</span> <span class="ss">number_of_shuriken</span><span class="p">:</span> <span class="mi">20</span><span class="p">)</span>
</span><span class='line'><span class="n">ninja</span><span class="o">.</span><span class="n">shurikens</span><span class="o">.</span><span class="n">length</span> <span class="c1"># =&gt; 20</span>
</span></code></pre></td></tr></table></div></figure>


<p>Also, through the evaluator object you have access to transient attributes too. That gives you the option to pass in addtional information when you “create” factory objects and need to tweak them on the fly. That gives you all the flexibility needed to play with associations and write expressive test data.</p>

<p>If you find the need to have multiple callbacks on your factory Factory Girl is not standing in your way—even multiple type ones. Naturally, order of execution is top to bottom.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="no">FactoryGirl</span><span class="o">.</span><span class="n">define</span> <span class="k">do</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">factory</span> <span class="ss">:henchman</span> <span class="k">do</span>
</span><span class='line'>    <span class="nb">name</span> <span class="s1">&#39;Mr. Hinx&#39;</span>
</span><span class='line'>    <span class="n">after</span><span class="p">(</span><span class="ss">:create</span><span class="p">)</span> <span class="p">{</span> <span class="o">|</span><span class="n">henchman</span><span class="o">|</span> <span class="n">henchman</span><span class="o">.</span><span class="n">send_on_kill_mission</span> <span class="p">}</span>
</span><span class='line'>    <span class="n">after</span><span class="p">(</span><span class="ss">:create</span><span class="p">)</span> <span class="p">{</span> <span class="n">send_cleaner</span> <span class="p">}</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="no">FactoryGirl</span><span class="o">.</span><span class="n">define</span> <span class="k">do</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">factory</span> <span class="ss">:bond_girl</span> <span class="k">do</span>
</span><span class='line'>    <span class="nb">name</span> <span class="s1">&#39;Lucia Sciarra&#39;</span>
</span><span class='line'>    <span class="n">after</span><span class="p">(</span><span class="ss">:build</span><span class="p">)</span>  <span class="p">{</span> <span class="o">|</span><span class="n">bond_girl</span><span class="o">|</span> <span class="n">bond_girl</span><span class="o">.</span><span class="n">hide_secret_documents</span>  <span class="p">}</span>
</span><span class='line'>    <span class="n">after</span><span class="p">(</span><span class="ss">:create</span><span class="p">)</span> <span class="p">{</span> <span class="n">close_hidden_safe_compartment</span> <span class="p">}</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>The devil is in the details of course. If you use <strong>create(:some_object)</strong>, both <strong>after(:build)</strong> and <strong>after(:create)</strong> callbacks will be exectuted.</p>

<p>Multiple build strategies can be bundled to execute the same callback as well.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="no">FactoryGirl</span><span class="o">.</span><span class="n">define</span> <span class="k">do</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">factory</span> <span class="ss">:spy</span> <span class="k">do</span>
</span><span class='line'>    <span class="nb">name</span> <span class="s1">&#39;Marty McFly&#39;</span>
</span><span class='line'>    <span class="n">after</span><span class="p">(</span><span class="ss">:stub</span><span class="p">,</span> <span class="ss">:build</span><span class="p">)</span> <span class="p">{</span> <span class="o">|</span><span class="n">spy</span><span class="o">|</span> <span class="n">spy</span><span class="o">.</span><span class="n">assign_new_mission</span> <span class="p">}</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>Last but not least, you can even setup something like “global” callbacks that override callbacks for all factories—at least in that particular file if you have separated them into multiple factory files.</p>

<p><strong>factories/gun.rb</strong></p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="no">FactoryGirl</span><span class="o">.</span><span class="n">define</span> <span class="k">do</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">before</span><span class="p">(</span><span class="ss">:stub</span><span class="p">,</span> <span class="ss">:build</span><span class="p">,</span> <span class="ss">:create</span><span class="p">)</span> <span class="p">{</span> <span class="o">|</span><span class="n">object</span><span class="o">|</span> <span class="n">object</span><span class="o">.</span><span class="n">assign_serial_number</span> <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">factory</span> <span class="ss">:spy_gun</span> <span class="k">do</span>
</span><span class='line'>    <span class="nb">name</span> <span class="s1">&#39;Walther PPK&#39;</span>
</span><span class='line'>    <span class="n">ammunition</span> <span class="s1">&#39;7.65mm Browning&#39;</span>
</span><span class='line'>    <span class="n">association</span> <span class="ss">:owner</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">factory</span> <span class="ss">:golden_gun</span> <span class="k">do</span>
</span><span class='line'>      <span class="nb">name</span> <span class="s1">&#39;Custom Lazar&#39;</span>
</span><span class='line'>      <span class="n">ammunition</span> <span class="s1">&#39;24-carat gold bullet&#39;</span>
</span><span class='line'>      <span class="n">after</span><span class="p">(</span><span class="ss">:create</span><span class="p">)</span> <span class="p">{</span> <span class="o">|</span><span class="n">golden_gun</span><span class="o">|</span> <span class="n">golden_gun</span><span class="o">.</span><span class="n">erase_serial_number</span> <span class="p">}</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<h3>Attention!</h3>

<p>If you use inheritance to compose child factories the callbacks on the parent will be inherited as well.</p>

<h3>The Last Mile</h3>

<p>Let’s bring it all together in the following sections about <em>associations</em> and <em>traits</em>—yes I also sneaked in <strong>alias</strong> because it was the best place without jumping all over the place. If you have paid attention and remember stuff from the first article everything should fall quite neatly into place now .</p>

<ul>
<li><h3>Associations</h3></li>
</ul>


<p>Associations are essential to every self respecting web app that has a little bit of complexity. A post that belongs to a user, a listing that has many ratings and so forth are the bread and butter developers have for breakfast any day of the week. Seen from that perspective it, becomes obvious that for more complex scenarios factories need to be bullet proof and easy to handle—at least in order to not mess with your TDD mojo. Emulating model associations via FactoryGirl is relatively straightforward I’d say. That in itself is quite amazing in my mind. Achieving a high level of ease and convenience for building complex data sets makes the practice of TDD a no-brainer and so much more effective.</p>

<p>The new Q has hacker skills and needs to own a decent computer right? In this case you have a <strong>Computer</strong> class and its instances belong to instances of the <strong>Quartermaster</strong> class. Easy right?</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="no">FactoryGirl</span><span class="o">.</span><span class="n">define</span> <span class="k">do</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">factory</span> <span class="ss">:quartermaster</span> <span class="k">do</span>
</span><span class='line'>    <span class="nb">name</span>   <span class="s1">&#39;Q&#39;</span>
</span><span class='line'>    <span class="n">skills</span> <span class="s1">&#39;Inventing stuff&#39;</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">factory</span> <span class="ss">:computer</span> <span class="k">do</span>
</span><span class='line'>    <span class="n">model</span> <span class="s1">&#39;Custom Lenovo ThinkPad W Series&#39;</span>
</span><span class='line'>    <span class="n">quartermaster</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>What about something a bit more involved? Let’s say our spies use a <strong>gun</strong> that has_many <strong>cartridges</strong> (bullets).</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">class</span> <span class="nc">Cartridge</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Base</span>
</span><span class='line'>  <span class="n">belongs_to</span> <span class="ss">:gun</span>
</span><span class='line'><span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="k">class</span> <span class="nc">Gun</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Base</span>
</span><span class='line'>  <span class="n">has_many</span> <span class="ss">:cartridges</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="no">FactoryGirl</span><span class="o">.</span><span class="n">define</span> <span class="k">do</span>
</span><span class='line'>  <span class="n">factory</span> <span class="ss">:cartridge</span> <span class="k">do</span>
</span><span class='line'>    <span class="n">caliber</span> <span class="s1">&#39;7.65&#39;</span>
</span><span class='line'>    <span class="n">gun</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">factory</span> <span class="ss">:gun</span> <span class="k">do</span>
</span><span class='line'>    <span class="nb">name</span> <span class="s1">&#39;Walther PPK&#39;</span>
</span><span class='line'>    <span class="n">ammunition</span> <span class="s1">&#39;7.65mm Browning&#39;</span>
</span><span class='line'>    <span class="n">caliber</span>    <span class="s1">&#39;7.65&#39;</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">factory</span> <span class="ss">:gun_with_ammo</span> <span class="k">do</span>
</span><span class='line'>      <span class="n">transient</span> <span class="k">do</span>
</span><span class='line'>        <span class="n">magazine_size</span> <span class="mi">10</span>
</span><span class='line'>      <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>      <span class="n">after</span><span class="p">(</span><span class="ss">:create</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">gun</span><span class="p">,</span> <span class="n">evaluator</span><span class="o">|</span>
</span><span class='line'>        <span class="n">create_list</span><span class="p">(</span><span class="ss">:cartridge</span><span class="p">,</span> <span class="n">evaluator</span><span class="o">.</span><span class="n">magazine_size</span><span class="p">,</span> <span class="ss">gun</span><span class="p">:</span> <span class="n">gun</span><span class="p">)</span>
</span><span class='line'>      <span class="k">end</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>Callbacks come in pretty handy with associtations huh? Now you can build a gun with or without ammunition. Via the hash <strong>gun: gun</strong> you provided the <strong>cartridge</strong> factory with the necessary information to create the association via the <strong>foreign_key</strong>.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">spy_gun</span> <span class="o">=</span> <span class="n">create</span><span class="p">(</span><span class="ss">:gun</span><span class="p">)</span>
</span><span class='line'><span class="n">spy_gun</span><span class="o">.</span><span class="n">cartridges</span><span class="o">.</span><span class="n">length</span> <span class="c1"># =&gt; 0</span>
</span><span class='line'>
</span><span class='line'><span class="n">spy_gun_with_ammo</span> <span class="o">=</span> <span class="n">create</span><span class="p">(</span><span class="ss">:gun_with_ammo</span><span class="p">)</span>
</span><span class='line'><span class="n">spy_gun_with_ammo</span><span class="o">.</span><span class="n">cartridges</span><span class="o">.</span><span class="n">length</span> <span class="c1"># =&gt; 10</span>
</span></code></pre></td></tr></table></div></figure>


<p>If you need another magazine size you can pass it in via your <strong>transient attribute</strong>.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">big_magazine_gun</span> <span class="o">=</span> <span class="n">create</span><span class="p">(</span><span class="ss">:gun_with_ammo</span><span class="p">,</span> <span class="ss">magazine_size</span><span class="p">:</span> <span class="mi">20</span><span class="p">)</span>
</span><span class='line'><span class="n">big_magazine_gun</span><span class="o">.</span><span class="n">cartridges</span><span class="o">.</span><span class="n">length</span> <span class="c1"># =&gt; 20</span>
</span></code></pre></td></tr></table></div></figure>


<p>So what about the different build strategies? Wasn’t there something fishy? Well, here’s what you need to remember: If you use <strong>create</strong> for associated objects both of them will be saved. So <strong>create(:quartermaster)</strong> will build and save both Q and his Thinkpad. I better use <strong>build</strong> then if I want to avoid hitting the database right? Good idea but <strong>build</strong> would only apply to <strong>quartermaster</strong> in our example—the associated <strong>computer</strong> would still get saved. A bit tricky I know. Here’s what you can do if you need to avoid saving the associated object—you specify the build strategy you need for your association.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="no">FactoryGirl</span><span class="o">.</span><span class="n">define</span> <span class="k">do</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">factory</span> <span class="ss">:quartermaster</span> <span class="k">do</span>
</span><span class='line'>    <span class="nb">name</span>   <span class="s1">&#39;Q&#39;</span>
</span><span class='line'>    <span class="n">skills</span> <span class="s1">&#39;Inventing stuff&#39;</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">factory</span> <span class="ss">:computer</span> <span class="k">do</span>
</span><span class='line'>    <span class="n">model</span> <span class="s1">&#39;Custom Lenovo ThinkPad W Series&#39;</span>
</span><span class='line'>    <span class="n">association</span> <span class="ss">:quartermaster</span><span class="p">,</span> <span class="ss">strategy</span><span class="p">:</span> <span class="ss">:build</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>You name the associated factory object and pass in a hash with your build strategy. You need to use the explicit <strong>association</strong> call for this to work. The example below won’t work.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">factory</span> <span class="ss">:computer</span> <span class="k">do</span>
</span><span class='line'>  <span class="n">model</span> <span class="s1">&#39;Custom Lenovo ThinkPad W Series&#39;</span>
</span><span class='line'>  <span class="n">quartermaster</span><span class="p">,</span> <span class="ss">strategy</span><span class="p">:</span> <span class="ss">:build</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>Now both objects use <strong>build</strong> and nothing gets saved to the database. We can check that assumption by using <strong>new_record?</strong> which returns <strong>true</strong> if the instance hasn’t been persisted.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">thinkpad</span> <span class="o">=</span> <span class="n">build</span><span class="p">(</span><span class="ss">:computer</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'><span class="n">thinkpad</span><span class="o">.</span><span class="n">new_record?</span>               <span class="c1"># =&gt; true</span>
</span><span class='line'><span class="n">thinkpad</span><span class="o">.</span><span class="n">quartermaster</span><span class="o">.</span><span class="n">new_record?</span> <span class="c1"># =&gt; true</span>
</span></code></pre></td></tr></table></div></figure>


<p>While we’re at it, via the explicit <strong>association</strong> call you can also refer to different factory names and change attributes on the fly.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="no">FactoryGirl</span><span class="o">.</span><span class="n">define</span> <span class="k">do</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">factory</span> <span class="ss">:quartermaster</span> <span class="k">do</span>
</span><span class='line'>    <span class="nb">name</span> <span class="s1">&#39;Q&#39;</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">factory</span> <span class="ss">:computer</span> <span class="k">do</span>
</span><span class='line'>    <span class="n">model</span> <span class="s1">&#39;Custom Lenovo ThinkPad W Series&#39;</span>
</span><span class='line'>    <span class="n">association</span> <span class="ss">:hacker</span><span class="p">,</span> <span class="ss">factory</span><span class="p">:</span> <span class="ss">:quartermaster</span><span class="p">,</span> <span class="ss">skills</span><span class="p">:</span> <span class="s1">&#39;Hacking&#39;</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>Let’s close this chapter with an example that is <strong>polymorphic</strong>.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">class</span> <span class="nc">Spy</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Base</span>
</span><span class='line'>  <span class="n">belongs_to</span> <span class="ss">:spyable</span><span class="p">,</span> <span class="ss">polymorpic</span><span class="p">:</span> <span class="kp">true</span>
</span><span class='line'><span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="k">class</span> <span class="nc">MIFive</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Base</span>
</span><span class='line'>  <span class="n">has_many</span> <span class="ss">:spies</span><span class="p">,</span> <span class="ss">as</span><span class="p">:</span> <span class="ss">:spyable</span>
</span><span class='line'><span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="k">class</span> <span class="nc">MISix</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Base</span>
</span><span class='line'>  <span class="n">has_many</span> <span class="ss">:spies</span><span class="p">,</span> <span class="ss">as</span><span class="p">:</span> <span class="ss">:spyable</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="no">FactoryGirl</span><span class="o">.</span><span class="n">define</span> <span class="k">do</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">factory</span> <span class="ss">:mifive</span> <span class="k">do</span>
</span><span class='line'>    <span class="nb">name</span>               <span class="s1">&#39;Military Intelligence, Section 5&#39;</span>
</span><span class='line'>    <span class="n">principal_activity</span> <span class="s1">&#39;Domestic counter-intelligence&#39;</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">factory</span> <span class="ss">:misix</span> <span class="k">do</span>
</span><span class='line'>    <span class="nb">name</span>               <span class="s1">&#39;Military Intelligence, Section 6&#39;</span>
</span><span class='line'>    <span class="n">principal_activity</span> <span class="s1">&#39;Foreign counter-intelligence&#39;</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">factory</span> <span class="ss">:mifive_spy</span><span class="p">,</span> <span class="ss">class</span><span class="p">:</span> <span class="no">Spy</span> <span class="k">do</span>
</span><span class='line'>    <span class="nb">name</span> <span class="s1">&#39;005&#39;</span>
</span><span class='line'>    <span class="n">association</span> <span class="ss">:spyable</span><span class="p">,</span> <span class="ss">factory</span><span class="p">:</span> <span class="ss">:mifive</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">factory</span> <span class="ss">:misix_spy</span><span class="p">,</span> <span class="ss">class</span><span class="p">:</span> <span class="no">Spy</span> <span class="k">do</span>
</span><span class='line'>    <span class="nb">name</span> <span class="s1">&#39;006&#39;</span>
</span><span class='line'>    <span class="n">association</span> <span class="ss">:spyable</span><span class="p">,</span> <span class="ss">factory</span><span class="p">:</span> <span class="ss">:misix</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="c1"># MI5 agents</span>
</span><span class='line'><span class="n">mifive</span> <span class="o">=</span> <span class="n">create</span><span class="p">(</span><span class="ss">:mifive</span><span class="p">)</span>
</span><span class='line'><span class="n">mifive_spy</span> <span class="o">=</span> <span class="n">create</span><span class="p">(</span><span class="ss">:mifive_spy</span><span class="p">)</span>
</span><span class='line'><span class="n">mifive</span><span class="o">.</span><span class="n">spies</span> <span class="o">&lt;&lt;</span> <span class="n">mifive_spy</span>
</span><span class='line'>
</span><span class='line'><span class="n">mifive</span><span class="o">.</span><span class="n">name</span>             <span class="c1"># =&gt; &quot;Military Intelligence, Section 5&quot;</span>
</span><span class='line'><span class="n">mifive_spy</span><span class="o">.</span><span class="n">name</span>         <span class="c1"># =&gt; &#39;005&#39;</span>
</span><span class='line'><span class="n">mifive</span><span class="o">.</span><span class="n">spies</span><span class="o">.</span><span class="n">length</span>     <span class="c1"># =&gt; 1</span>
</span><span class='line'><span class="n">mifive</span><span class="o">.</span><span class="n">spies</span><span class="o">.</span><span class="n">first</span><span class="o">.</span><span class="n">name</span> <span class="c1"># =&gt; &#39;005&#39;</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="c1"># MI6 agents</span>
</span><span class='line'><span class="n">misix</span> <span class="o">=</span> <span class="n">create</span><span class="p">(</span><span class="ss">:misix</span><span class="p">)</span>
</span><span class='line'><span class="n">misix_spy_01</span> <span class="o">=</span> <span class="n">create</span><span class="p">(</span><span class="ss">:misix_spy</span><span class="p">,</span> <span class="nb">name</span><span class="p">:</span> <span class="s1">&#39;007&#39;</span><span class="p">)</span>
</span><span class='line'><span class="n">misix_spy_02</span> <span class="o">=</span> <span class="n">create</span><span class="p">(</span><span class="ss">:misix_spy</span><span class="p">)</span>
</span><span class='line'><span class="n">misix</span><span class="o">.</span><span class="n">spies</span> <span class="o">&lt;&lt;</span> <span class="n">misix_spy_01</span>
</span><span class='line'><span class="n">misix</span><span class="o">.</span><span class="n">spies</span> <span class="o">&lt;&lt;</span> <span class="n">misix_spy_02</span>
</span><span class='line'>
</span><span class='line'><span class="n">misix</span><span class="o">.</span><span class="n">name</span>              <span class="c1"># =&gt; &quot;Military Intelligence, Section 6&quot;</span>
</span><span class='line'><span class="n">misix</span><span class="o">.</span><span class="n">spies</span><span class="o">.</span><span class="n">length</span>      <span class="c1"># =&gt; 2</span>
</span><span class='line'><span class="n">misix_spy_01</span><span class="o">.</span><span class="n">name</span>       <span class="c1"># =&gt; &#39;007&#39;</span>
</span><span class='line'><span class="n">misix_spy_02</span><span class="o">.</span><span class="n">name</span>       <span class="c1"># =&gt; &#39;006&#39;</span>
</span><span class='line'><span class="n">misix</span><span class="o">.</span><span class="n">spies</span><span class="o">.</span><span class="n">first</span><span class="o">.</span><span class="n">name</span>  <span class="c1"># =&gt; &#39;007&#39;</span>
</span></code></pre></td></tr></table></div></figure>


<p>Don’t feel bad if this one needs a bit more time to sink in. I recommend catching up on <a href="http://guides.rubyonrails.org/association_basics.html#polymorphic-associations"><strong>Polymorphic Associations</strong></a> if you’re unsure what’s going on here.</p>

<ul>
<li><h3>Aliases</h3></li>
</ul>


<p>Aliases for your factories allow you to be more expressive about the context that you are using your factory objects in. You only need to provide a hash of alternative names that better describe the relationship between associated objects.</p>

<p> Let’s say you have an <strong>:agent</strong> factory and a <strong>:law_enforcement_vehicle</strong> factory. Wouldn’t it be nice to refer to the agent as <strong>:owner</strong> in the context of these cars? In the example below I contrasted it with an example without an alias.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="no">FactoryGirl</span><span class="o">.</span><span class="n">define</span> <span class="k">do</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">factory</span> <span class="ss">:agent</span><span class="p">,</span> <span class="ss">aliases</span><span class="p">:</span> <span class="o">[</span><span class="ss">:owner</span><span class="o">]</span> <span class="k">do</span>
</span><span class='line'>    <span class="nb">name</span>   <span class="s1">&#39;Fox Mulder&#39;</span>
</span><span class='line'>    <span class="n">job</span>    <span class="s1">&#39;Chasing bad dudes&#39;</span>
</span><span class='line'>    <span class="n">special_skills</span> <span class="s1">&#39;Investigation and intelligence&#39;</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">factory</span> <span class="ss">:double_O_seven</span> <span class="k">do</span>
</span><span class='line'>      <span class="nb">name</span> <span class="s1">&#39;James Bond&#39;</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">factory</span> <span class="ss">:law_enforcement_vehicle</span> <span class="k">do</span>
</span><span class='line'>    <span class="nb">name</span> <span class="s1">&#39;Oldsmobile Achieva&#39;</span>
</span><span class='line'>    <span class="n">kind</span> <span class="s1">&#39;Compact car&#39;</span>
</span><span class='line'>    <span class="ss">:owner</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">factory</span> <span class="ss">:spy_car</span> <span class="k">do</span>
</span><span class='line'>    <span class="nb">name</span> <span class="s1">&#39;Aston Martin DB9&#39;</span>
</span><span class='line'>    <span class="n">kind</span> <span class="s1">&#39;Sports car&#39;</span>
</span><span class='line'>    <span class="n">double_O_seven</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<h4>Attention!</h4>

<p>Don’t forget to add a colon in front of the aliased factory (<strong>:owner</strong>) when you use them for associations in your factories. The documentation and many blog posts use them without colons in these cases. All you get is probably a <strong>NoMethodError</strong> because you are missing a setter method for that alias now. (I’ll better open a pull request) The first time I ran into this baffled me and took me a a bit get passed it. Remember to sometimes selectively distrust documentations and blogs posts. Yours truly as well of course.</p>

<p> I think you’ll agree that using aliases it not only reads better but it also gives you or the person who comes after you a bit more context about the objects in question. Yeah, you need to use plural <strong>:aliases</strong> also if you have only a single alias.</p>

<p>You could write this a bit different as well—a lot more verbose.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">factory</span> <span class="ss">:agent</span><span class="p">,</span> <span class="ss">aliases</span><span class="p">:</span> <span class="o">[</span><span class="ss">:mulder</span><span class="o">]</span> <span class="k">do</span>
</span><span class='line'>  <span class="nb">name</span>   <span class="s1">&#39;Fox Mulder&#39;</span>
</span><span class='line'>  <span class="n">job</span>    <span class="s1">&#39;Chasing bad dudes&#39;</span>
</span><span class='line'>  <span class="n">special_skills</span> <span class="s1">&#39;Investigation and intelligence&#39;</span>
</span><span class='line'><span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="n">factory</span> <span class="ss">:law_enforcement_vehicle</span> <span class="k">do</span>
</span><span class='line'>  <span class="nb">name</span> <span class="s1">&#39;Oldsmobile Achieva&#39;</span>
</span><span class='line'>  <span class="n">kind</span> <span class="s1">&#39;Compact car&#39;</span>
</span><span class='line'>  <span class="n">association</span> <span class="ss">:owner</span><span class="p">,</span> <span class="ss">factory</span><span class="p">:</span> <span class="ss">:agent</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>Well, not that neat isn’t it?</p>

<p>Of course you can use these aliases also to “build” factory objects right away.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">fbi_agent</span> <span class="o">=</span> <span class="n">create</span><span class="p">(</span><span class="ss">:mulder</span><span class="p">)</span>
</span><span class='line'><span class="n">fbi_agent</span><span class="o">.</span><span class="n">name</span> <span class="c1"># =&gt; &#39;Fox Mulder&#39;</span>
</span></code></pre></td></tr></table></div></figure>


<p>In the context of comments, a <strong>:user</strong> could be referred to as <strong>:commenter</strong>, in the case of a <strong>:crime</strong> a <strong>:user</strong> could be aliased as a <strong>:suspect</strong> and so on. Its no rocket science really—more like convenient syntactic sugar that decreases your temptation for duplication.</p>

<ul>
<li><h3>Traits</h3></li>
</ul>


<p>This is one of my favorite things about Factory Girl. In a nutshell, traits are lego-like blocks to build your factories and mix in behaviour. They are comma separated lists of symbol traits / attributes that you wanna add-on to a particular factory and they are also defined in your factories file(s). In my mind, <strong>trait</strong> is the most powerful and convenient function to keep your factory data DRY while being expressive at the same time. It allows you to bundle groups of attributes together, give them separate names and reuse them wherever you please. Remember when I urged you to define barebones factory objects? Traits will help you achieve exactly that without sacrificing any conveniences.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="no">FactoryGirl</span><span class="o">.</span><span class="n">define</span> <span class="k">do</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">factory</span> <span class="ss">:spy_car</span> <span class="k">do</span>
</span><span class='line'>    <span class="n">model</span>         <span class="s1">&#39;Aston Martin DB9&#39;</span>
</span><span class='line'>    <span class="n">top_speed</span>     <span class="s1">&#39;295 km/h&#39;</span>
</span><span class='line'>    <span class="n">build_date</span>    <span class="s1">&#39;2015&#39;</span>
</span><span class='line'>    <span class="n">ejection_seat</span> <span class="kp">true</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">trait</span> <span class="ss">:submarine</span> <span class="k">do</span>
</span><span class='line'>      <span class="n">ejection_seat</span>              <span class="kp">false</span>
</span><span class='line'>      <span class="n">water_resistant</span>            <span class="s1">&#39;100 m&#39;</span>
</span><span class='line'>      <span class="n">submarine_capabilities</span>     <span class="kp">true</span>
</span><span class='line'>      <span class="n">air_independent_propulsion</span> <span class="kp">true</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">trait</span> <span class="ss">:weaponized</span> <span class="k">do</span>
</span><span class='line'>      <span class="n">rockets</span>           <span class="kp">true</span>
</span><span class='line'>      <span class="n">number_of_rockets</span> <span class="s1">&#39;12&#39;</span>
</span><span class='line'>      <span class="n">machine_gun</span>       <span class="kp">true</span>
</span><span class='line'>      <span class="n">rate_of_fire</span>      <span class="s1">&#39;1,500 RPM&#39;</span>
</span><span class='line'>      <span class="n">tank_armour</span>       <span class="kp">true</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">trait</span> <span class="ss">:cloaked</span> <span class="k">do</span>
</span><span class='line'>      <span class="n">active_camouflage</span> <span class="kp">true</span>
</span><span class='line'>      <span class="n">radar_signature</span>   <span class="s1">&#39;reduced&#39;</span>
</span><span class='line'>      <span class="n">engine</span>            <span class="s1">&#39;silenced&#39;</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">trait</span> <span class="ss">:night_vision</span> <span class="k">do</span>
</span><span class='line'>      <span class="n">infrared_sensors</span> <span class="kp">true</span>
</span><span class='line'>      <span class="n">heads_up_display</span> <span class="kp">true</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>As you can see, if you want to change some attributes that are spread over multiple objects, you can do that now in one central place. No shotgun surgery necessary. Managing state via traits couldn’t be more convenient. With that setup you can build pretty elaborate spy cars by mixing the various attribute bundles however you like—without duplicating anything via creating all sorts of new factories that account for all the various options you need.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">invisible_spy_car</span> <span class="o">=</span> <span class="n">create</span><span class="p">(</span><span class="ss">:spy_car</span><span class="p">,</span> <span class="ss">:cloaked</span><span class="p">,</span> <span class="ss">:night_vision</span><span class="p">)</span>
</span><span class='line'><span class="n">diving_spy_car</span>    <span class="o">=</span> <span class="n">create</span><span class="p">(</span><span class="ss">:spy_car</span><span class="p">,</span> <span class="ss">:submarine</span><span class="p">,</span> <span class="ss">:cloaked</span><span class="p">)</span>
</span><span class='line'><span class="n">tank_spy_car</span>      <span class="o">=</span> <span class="n">create</span><span class="p">(</span><span class="ss">:spy_car</span><span class="p">,</span> <span class="ss">:weaponized</span><span class="p">,</span> <span class="ss">:night_vision</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>You can use traits with <strong>create</strong>, <strong>build</strong>, <strong>build_stubbed</strong> and <strong>attributes_for</strong>. If Q gets clever, you can also ovverride individual attributes simultaneously by passing in a hash.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">build</span><span class="p">(</span><span class="ss">:spy_car</span><span class="p">,</span> <span class="ss">:submarine</span><span class="p">,</span> <span class="ss">ejection_seat</span><span class="p">:</span> <span class="kp">true</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>For trait combinations that occur very frequently on a particular factory you can also create child factories with names that best represent the various data set combos. That way you bundle their traits only once as opposed to all the time when you create test data.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="no">FactoryGir</span><span class="o">.</span><span class="n">define</span> <span class="k">do</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">factory</span> <span class="ss">:spy_car</span> <span class="k">do</span>
</span><span class='line'>    <span class="n">model</span>         <span class="s1">&#39;Aston Martin DB9&#39;</span>
</span><span class='line'>    <span class="n">top_speed</span>     <span class="s1">&#39;295 km/h&#39;</span>
</span><span class='line'>    <span class="n">build_date</span>    <span class="s1">&#39;2015&#39;</span>
</span><span class='line'>    <span class="n">ejection_seat</span> <span class="kp">true</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">trait</span> <span class="ss">:submarine</span> <span class="k">do</span>
</span><span class='line'>      <span class="o">.</span><span class="n">.</span><span class="o">.</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">trait</span> <span class="ss">:weaponized</span> <span class="k">do</span>
</span><span class='line'>      <span class="o">.</span><span class="n">.</span><span class="o">.</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">trait</span> <span class="ss">:cloaked</span> <span class="k">do</span>
</span><span class='line'>      <span class="o">.</span><span class="n">.</span><span class="o">.</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">trait</span> <span class="ss">:night_vision</span> <span class="k">do</span>
</span><span class='line'>      <span class="o">.</span><span class="n">.</span><span class="o">.</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">factory</span> <span class="ss">:invisible_spy_car</span><span class="p">,</span> <span class="ss">traits</span><span class="p">:</span> <span class="o">[</span><span class="ss">:cloaked</span><span class="p">,</span> <span class="ss">:night_vision</span><span class="o">]</span>
</span><span class='line'>    <span class="n">factory</span> <span class="ss">:diving_spy_car</span><span class="p">,</span>    <span class="ss">traits</span><span class="p">:</span> <span class="o">[</span><span class="ss">:submarine</span><span class="p">,</span> <span class="ss">:cloaked</span><span class="o">]</span>
</span><span class='line'>    <span class="n">factory</span> <span class="ss">:tank_spy_car</span><span class="p">,</span>      <span class="ss">traits</span><span class="p">:</span> <span class="o">[</span><span class="ss">:weaponized</span><span class="p">,</span> <span class="ss">:night_vision</span><span class="o">]</span>
</span><span class='line'>    <span class="n">factory</span> <span class="ss">:ultimate_spy_car</span><span class="p">,</span>  <span class="ss">traits</span><span class="p">:</span> <span class="o">[</span><span class="ss">:cloaked</span><span class="p">,</span> <span class="ss">:night_vision</span><span class="p">,</span> <span class="ss">:submarine</span><span class="p">,</span> <span class="ss">:weaponized</span><span class="o">]</span>
</span><span class='line'>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>This let’s you create these objects more much concise—more readable too.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">build_stubbed</span><span class="p">(</span><span class="ss">:invisible_spy_car</span><span class="p">)</span>
</span><span class='line'><span class="n">create</span><span class="p">(</span><span class="ss">:ultimate_spy_car</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>Instead of:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">build_stubbed</span><span class="p">(</span><span class="ss">:spy_car</span><span class="p">,</span> <span class="ss">:cloaked</span><span class="p">,</span> <span class="ss">:night_vision</span><span class="p">)</span>
</span><span class='line'><span class="n">create</span><span class="p">(</span><span class="ss">:spy_car</span><span class="p">,</span> <span class="ss">:cloaked</span><span class="p">,</span> <span class="ss">:night_vision</span><span class="p">,</span> <span class="ss">:submarine</span><span class="p">,</span> <span class="ss">:weaponized</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>Reads much better no? Especially when no variable names are involved.</p>

<p>You can even reuse traits as attributes on other traits and factories. If you define the same attributes for multiple traits, the last one defined gets precedence of course.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="no">FactoryGirl</span><span class="o">.</span><span class="n">define</span> <span class="k">do</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">factory</span> <span class="ss">:spy_car</span> <span class="k">do</span>
</span><span class='line'>    <span class="n">model</span>         <span class="s1">&#39;Aston Martin DB9&#39;</span>
</span><span class='line'>    <span class="n">top_speed</span>     <span class="s1">&#39;295 km/h&#39;</span>
</span><span class='line'>    <span class="n">build_date</span>    <span class="s1">&#39;2015&#39;</span>
</span><span class='line'>    <span class="n">ejection_seat</span> <span class="kp">true</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">trait</span> <span class="ss">:submarine</span> <span class="k">do</span>
</span><span class='line'>      <span class="o">.</span><span class="n">.</span><span class="o">.</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">trait</span> <span class="ss">:weaponized</span> <span class="k">do</span>
</span><span class='line'>      <span class="o">.</span><span class="n">.</span><span class="o">.</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">trait</span> <span class="ss">:cloaked</span> <span class="k">do</span>
</span><span class='line'>      <span class="o">.</span><span class="n">.</span><span class="o">.</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">trait</span> <span class="ss">:night_vision</span> <span class="k">do</span>
</span><span class='line'>      <span class="o">.</span><span class="n">.</span><span class="o">.</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">trait</span> <span class="ss">:mobile_surveillance</span> <span class="k">do</span>
</span><span class='line'>      <span class="n">cloaked</span>
</span><span class='line'>      <span class="n">night_vision</span>
</span><span class='line'>      <span class="n">signal_detector</span>      <span class="kp">true</span>
</span><span class='line'>      <span class="n">signal_analyzer</span>      <span class="kp">true</span>
</span><span class='line'>      <span class="n">wifi_war_driver</span>      <span class="kp">true</span>
</span><span class='line'>      <span class="n">license_plate_reader</span> <span class="kp">true</span>
</span><span class='line'>      <span class="n">mini_drone</span>           <span class="kp">true</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">factory</span> <span class="ss">:ultimate_spy_car</span><span class="p">,</span> <span class="ss">parent</span><span class="p">:</span> <span class="ss">:spy_car</span> <span class="k">do</span>
</span><span class='line'>    <span class="n">car_plane</span> <span class="kp">true</span>
</span><span class='line'>    <span class="n">submarine</span>
</span><span class='line'>    <span class="n">weaponized</span>
</span><span class='line'>    <span class="n">mobile_surveillance</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>Pay attention to the <strong>mobile_surveillance</strong> trait which reuses the <strong>cloaked</strong> and <strong>night_vision</strong> traits—basically as an attribute. Also the <strong>ultimate_spy_car</strong> factory, which I separated out of the <strong>spy_car</strong> factory definition for fun this time, reuses all traits plus an additional attribute that makes it fly too. Pure movie magic—or maybe I should say FactoryGirl magic.</p>

<p><strong>create_list</strong> and <strong>build_list</strong> can also make use of traits. The second parameter needs to be the number of factory instances you want.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">create_list</span><span class="p">(</span><span class="ss">:spy_car</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="ss">:night_vision</span><span class="p">)</span>
</span><span class='line'><span class="n">build_list</span><span class="p">(</span><span class="ss">:spy_car</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="ss">:submarine</span><span class="p">,</span> <span class="ss">:cloaked</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>Wouldn’t it be cool to use associations with traits? Of course you can pack callbacks and associations neatly into traits. Duh!</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="no">FactoryGirl</span><span class="o">.</span><span class="n">define</span> <span class="k">do</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">factory</span> <span class="ss">:cartridge</span> <span class="k">do</span>
</span><span class='line'>    <span class="n">kind</span>       <span class="s1">&#39;Small calliber pistol ammunition&#39;</span>
</span><span class='line'>    <span class="n">caliber</span>    <span class="s1">&#39;7.65&#39;</span>
</span><span class='line'>    <span class="n">projectile</span> <span class="s1">&#39;Lead&#39;</span>
</span><span class='line'>    <span class="n">gun</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">factory</span> <span class="ss">:golden_cartridge</span> <span class="k">do</span>
</span><span class='line'>      <span class="n">projectile</span> <span class="s1">&#39;Gold&#39;</span>
</span><span class='line'>      <span class="n">association</span> <span class="ss">:gun</span><span class="p">,</span> <span class="ss">:golden</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">factory</span> <span class="ss">:gun</span> <span class="k">do</span>
</span><span class='line'>    <span class="nb">name</span> <span class="s1">&#39;Walther PPK&#39;</span>
</span><span class='line'>    <span class="n">ammunition</span> <span class="s1">&#39;7.65mm Browning&#39;</span>
</span><span class='line'>    <span class="n">caliber</span>    <span class="s1">&#39;7.65&#39;</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">transient</span> <span class="k">do</span>
</span><span class='line'>      <span class="n">magazine_size</span> <span class="mi">10</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">trait</span> <span class="ss">:golden</span> <span class="k">do</span>
</span><span class='line'>      <span class="nb">name</span> <span class="s1">&#39;Custom Lazar&#39;</span>
</span><span class='line'>      <span class="n">ammunition</span> <span class="s1">&#39;23-carat gold bullet&#39;</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">trait</span> <span class="ss">:with_ammo</span> <span class="k">do</span>
</span><span class='line'>      <span class="n">after</span><span class="p">(</span><span class="ss">:create</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">gun</span><span class="p">,</span> <span class="n">evaluator</span><span class="o">|</span>
</span><span class='line'>        <span class="n">create_list</span><span class="p">(</span><span class="ss">:cartridge</span><span class="p">,</span> <span class="n">evaluator</span><span class="o">.</span><span class="n">magazine_size</span><span class="p">,</span> <span class="ss">gun</span><span class="p">:</span> <span class="n">gun</span><span class="p">)</span>
</span><span class='line'>      <span class="k">end</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">trait</span> <span class="ss">:with_golden_ammo</span> <span class="k">do</span>
</span><span class='line'>      <span class="n">after</span><span class="p">(</span><span class="ss">:create</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">golden_gun</span><span class="p">,</span> <span class="n">evaluator</span><span class="o">|</span>
</span><span class='line'>        <span class="n">create_list</span><span class="p">(</span><span class="ss">:golden_cartridge</span><span class="p">,</span> <span class="n">evaluator</span><span class="o">.</span><span class="n">magazine_size</span><span class="p">,</span> <span class="ss">gun</span><span class="p">:</span> <span class="n">golden_gun</span><span class="p">)</span>
</span><span class='line'>      <span class="k">end</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>How to use them should be boring by now.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">cartridge</span> <span class="o">=</span> <span class="n">create</span><span class="p">(</span><span class="ss">:cartridge</span><span class="p">)</span>
</span><span class='line'><span class="n">cartridge</span><span class="o">.</span><span class="n">projectile</span>     <span class="c1"># =&gt; &#39;Lead&#39;</span>
</span><span class='line'><span class="n">cartridge</span><span class="o">.</span><span class="n">gun</span><span class="o">.</span><span class="n">name</span>       <span class="c1"># =&gt; &#39;Walther PPK&#39;</span>
</span><span class='line'><span class="n">cartridge</span><span class="o">.</span><span class="n">gun</span><span class="o">.</span><span class="n">ammunition</span> <span class="c1"># =&gt; &#39;7.65mm Browning&#39;</span>
</span><span class='line'><span class="n">cartridge</span><span class="o">.</span><span class="n">gun</span><span class="o">.</span><span class="n">caliber</span>    <span class="c1"># =&gt; &#39;7.65&#39;</span>
</span><span class='line'>
</span><span class='line'><span class="n">golden_cartridge</span> <span class="o">=</span> <span class="n">create</span><span class="p">(</span><span class="ss">:golden_cartridge</span><span class="p">)</span>
</span><span class='line'><span class="n">golden_cartridge</span><span class="o">.</span><span class="n">projectile</span>     <span class="c1"># =&gt; &#39;Gold&#39;</span>
</span><span class='line'><span class="n">golden_cartridge</span><span class="o">.</span><span class="n">gun</span><span class="o">.</span><span class="n">name</span>       <span class="c1"># =&gt; &#39;Custom Lazar&#39;</span>
</span><span class='line'><span class="n">golden_cartridge</span><span class="o">.</span><span class="n">gun</span><span class="o">.</span><span class="n">ammunition</span> <span class="c1"># =&gt; &#39;23-carat gold bullet&#39;</span>
</span><span class='line'><span class="n">golden_cartridge</span><span class="o">.</span><span class="n">gun</span><span class="o">.</span><span class="n">caliber</span>    <span class="c1"># =&gt; &#39;7.65&#39;</span>
</span><span class='line'>
</span><span class='line'><span class="n">gun_with_ammo</span> <span class="o">=</span> <span class="n">create</span><span class="p">(</span><span class="ss">:gun</span><span class="p">,</span> <span class="ss">:with_ammo</span><span class="p">)</span>
</span><span class='line'><span class="n">gun_with_ammo</span><span class="o">.</span><span class="n">name</span>                        <span class="c1"># =&gt; &#39;Walther PPK&#39;</span>
</span><span class='line'><span class="n">gun_with_ammo</span><span class="o">.</span><span class="n">ammunition</span>                  <span class="c1"># =&gt; &#39;7.65mm Browning&#39; </span>
</span><span class='line'><span class="n">gun_with_ammo</span><span class="o">.</span><span class="n">cartridges</span><span class="o">.</span><span class="n">length</span>           <span class="c1"># =&gt; 10</span>
</span><span class='line'><span class="n">gun_with_ammo</span><span class="o">.</span><span class="n">cartridges</span><span class="o">.</span><span class="n">first</span><span class="o">.</span><span class="n">projectile</span> <span class="c1"># =&gt; &#39;Lead&#39;</span>
</span><span class='line'><span class="n">gun_with_ammo</span><span class="o">.</span><span class="n">cartridges</span><span class="o">.</span><span class="n">first</span><span class="o">.</span><span class="n">caliber</span>    <span class="c1"># =&gt; &#39;7.65&#39;</span>
</span><span class='line'>
</span><span class='line'><span class="n">golden_gun_with_golden_ammo</span> <span class="o">=</span> <span class="n">create</span><span class="p">(</span><span class="ss">:gun</span><span class="p">,</span> <span class="ss">:golden</span><span class="p">,</span> <span class="ss">:with_golden_ammo</span><span class="p">)</span>
</span><span class='line'><span class="n">golden_gun_with_golden_ammo</span><span class="o">.</span><span class="n">name</span>                        <span class="c1"># =&gt; &#39;Custom Lazar&#39;</span>
</span><span class='line'><span class="n">golden_gun_with_golden_ammo</span><span class="o">.</span><span class="n">ammunition</span>                  <span class="c1"># =&gt; &#39;24-carat gold bullet&#39; </span>
</span><span class='line'><span class="n">golden_gun_with_golden_ammo</span><span class="o">.</span><span class="n">cartridges</span><span class="o">.</span><span class="n">length</span>           <span class="c1"># =&gt; 10</span>
</span><span class='line'><span class="n">golden_gun_with_golden_ammo</span><span class="o">.</span><span class="n">cartridges</span><span class="o">.</span><span class="n">first</span><span class="o">.</span><span class="n">projectile</span> <span class="c1"># =&gt; &#39;Gold&#39;</span>
</span><span class='line'><span class="n">golden_gun_with_golden_ammo</span><span class="o">.</span><span class="n">cartridges</span><span class="o">.</span><span class="n">first</span><span class="o">.</span><span class="n">caliber</span>    <span class="c1"># =&gt; &#39;7.65&#39;</span>
</span></code></pre></td></tr></table></div></figure>


<ul>
<li><h3>Final Thoughts</h3></li>
</ul>


<p>Last words of wisdom: Change is your constant companion—needing to change attributes or data types happens all the time. Design decisions like these evolve. Traits will ease the pain with that and helps you manage your data sets. Imagine if you’d have used an options hash for instantiation and that requirement totally changed. How many potential places in your tests might break and will now need attention? Straight up, <strong>trait</strong> is a very effective tool for eliminating duplication in your test suite. But with all that convenience, don’t be lazy and forget your unit tests on the columns that are represented by your traits! That way you give them the same amount of care as the barebones attributes needed for valid objects.</p>

<p>There is a bit more to discover in FactoryGirl and I’m confident you are now more than well equipped to put the pieces together when you need them. Have fun playing with this gem. I hope your TDD habits will benefit from it.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/octopress_drafts_previewer/blog/2015/10/12/Factory-Girl-Guide-01/">Factory Girl 101</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2015-10-12T05:29:10+02:00'><span class='date'><span class='date-month'>Oct</span> <span class='date-day'>12</span><span class='date-suffix'>th</span>, <span class='date-year'>2015</span></span> <span class='time'>5:29 am</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p><img src="/octopress_drafts_previewer/images/Factory-Girl-Guide/hine-lewis-national-child-labor-committee-collection.jpg"></p>

<p><a href="https://github.com/thoughtbot/factory_girl"><img src="/octopress_drafts_previewer/images/Factory-Girl-Guide/Factory-Girl-Icon.png" width="150"></a></p>

<p>This two-part mini-series was written for people who quickly wanna jump into working with Factory Girl and cut to the chase without digging through the documentation for themselves too much. For folks who started to play with tests rather recently I did my best to keep it newbie-friendly. Obviously having been in the same shoes at some point made me believe that it doesn’t take much to make new people feel more comfortable with testing. Taking a bit more time to explain the context and demystifying the lingo goes a long way in cutting down frustration rates for beginners imho.</p>

<h3>Contents</h3>

<ul>
<li>Intro &amp; Context</li>
<li>Fixtures</li>
<li>Configuration</li>
<li>Defining factories</li>
<li>Using factories</li>
<li>Inheritance</li>
<li>Multiple records</li>
<li><p>Sequences</p></li>
<li><h3>Intro &amp; Context</h3></li>
</ul>


<p>Let’s start with a little bit of history and talk about the fine folks at <a href="https://thoughtbot.com/">thoughtbot</a> who are responsible for this popular Ruby gem. Back in 2007/2008 <a href="https://github.com/jferris">Joe Ferries</a>, CTO at thoughtbot, had had it with fixtures and started to cook up his own solution. Going through various files to test a single method was a common pain point while dealing with fixtures. Put differently and ignoring all kinds of inflexiblities, that practice also lead to writing tests that don’t tell you much about their context being tested right away.</p>

<p>Not being sold on that current practice made him check out various solutions for factories but none of them supported everything he wanted. So he came up with Factory Girl which made testing with test data more readable, DRY and also more explicit by giving you the context for every test. A couple of years later, <a href="https://twitter.com/joshuaclayton">Josh Clayton</a>, Development Director at @thoughtbot in Boston, took over as the maintainer of the project. Over time this gem has grown steadily and became a “fixture” in the Ruby community.</p>

<p>Let’s talk more about the main pain points Factory Girl solves. When you build your test suite you’re dealing with a lot of associated records and with information that’s changing frequently. You want to be able to build data sets for your integration tests that are not brittle, easy to manage and explicit. Your data factories should be dynamic and able to refer to other factories—something that is in part beyond YAML fixtures from the old days. Another convenience you want to have is the ability to overwrite attributes for objects on the fly. Factory Girl allows you to do all of that effortlessly—given the fact that it is written in Ruby and a lot of Metaprogramming witchraft is going on behind the scenes—and you are provided with a great domain-specific language that is easy on the eyes too.</p>

<p>Building up your fixture data with this gem can be described as easy, effective and overall more convenient than fiddling with fixtures. That way you can deal more with concepts than with the actual columns in the database. But enough of talking the talk, let’s get our hands a bit dirty.</p>

<ul>
<li><h3>Fixtures?</h3></li>
</ul>


<p>Folks who have experience with testing applications and who don’t need to learn about the concept of fixtures, please feel free to jump right ahead to the next section. This one is for newbies who just need an update about testing data.</p>

<p>Fixtures are sample data—that’s it really! For a good chunk of your test suite you want to be able to populate your test database with data that is tailored to your specific test cases. For quite a while, many devs used <a href="https://en.wikipedia.org/wiki/YAML">YAML</a> for this data—which made it database independent. In hindsight, being independent that way may have been the best thing about it. It was more or less one file per model. That alone might give you an idea about all kinds of headaches people were complaining about. Complexity is a fast growing enemy that YAML is hardly equiped to take on effectively. Below you’ll see what such a <strong>.yml</strong> file with test data looks like.</p>

<p>YAML file: <strong>secret_service.yml</strong></p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='yaml'><span class='line'><span class="l-Scalar-Plain">Quartermaster</span><span class="p-Indicator">:</span>
</span><span class='line'>  <span class="l-Scalar-Plain">name</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">Q</span>
</span><span class='line'>  <span class="l-Scalar-Plain">favorite_gadget</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">Broom radio</span>
</span><span class='line'>  <span class="l-Scalar-Plain">skills</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">Inventing gizmos and hacking</span>
</span><span class='line'>
</span><span class='line'><span class="l-Scalar-Plain">00 Agent</span><span class="p-Indicator">:</span>
</span><span class='line'>  <span class="l-Scalar-Plain">name</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">James Bond</span>
</span><span class='line'>  <span class="l-Scalar-Plain">favorite_gadget</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">Submarine Lotus Esprit</span>
</span><span class='line'>  <span class="l-Scalar-Plain">skills</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">Getting Bond Girls killed and covert infiltration</span>
</span></code></pre></td></tr></table></div></figure>


<p>It looks like a hash, doesn’t it? Its a colon-separeted list of key / value pairs that are separated by a blank space. You can reference other nodes within each other if you want to simulate associations from your models. But I think its fair to say that that’s where the music stops and many say their pain begins. For data sets that are a bit more involved, YAML fixtures are difficult to maintain and hard to change without affecting other tests. I mean you can make them work of course—after all developers used them plenty in the past—but many people agreed that the price to pay for managing fixtures is just a bit stingy.</p>

<p>To avoid breaking your test data when the inevitable changes occur, developers where happy to adopt newer strategies that offered more flexibility and dynamic behaviour. That’s where Factory Girl came in and left the YAML days behind. Another issue is the heavy dependency between the test and the <strong>.yml</strong> fixture file. <a href="https://robots.thoughtbot.com/mystery-guest">Mystery guests</a> are also a major pain with these kinds of fixtures. Factory Girl let’s you avoid that by creating objects relevant to the tests inline.</p>

<p>Sure, YAML fixtures are fast and I’ve heard people argue that a slow test suite with Factory Girl data made them go back YAML land. In my mind, if you are using Factory Girl so much that it really slows down your tests, you might be overusing factories unnecessarily and you might ignore strategies that are not hitting the database. You’ll see what I mean when we get to the relevant section(s). Of course, use whatever you need / see fit but consider yourself warned if you get burned by YAML.</p>

<p>I think it would be fair to add that in the early days of Rails and Ruby TDD, YAML fixtures were the de facto standard for setting up test data in your application. They played an important role and helped move the industry forward. Nowadays they have a reasonably bad rep though. Times change so let’s move on to factories which are meant to replace fixtures.</p>

<ul>
<li><h3>Configuration</h3></li>
</ul>


<p>I assume you already have Ruby and <a href="http://rspec.info/">RSpec</a> for testing installed on your system. If not, come back after consulting Google and you should be good to go. Its quite straightforward I’d say. You can install the gem manually in your terminal via</p>

<p><strong>Shell:</strong></p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>gem install factory_girl
</span></code></pre></td></tr></table></div></figure>


<p>or add it to your <strong>Gemfile:</strong></p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">gem</span> <span class="s2">&quot;factory_girl&quot;</span><span class="p">,</span> <span class="s2">&quot;~&gt; 4.0&quot;</span>
</span></code></pre></td></tr></table></div></figure>


<p>and run <code>bundle install</code>.</p>

<p>Now you only need to <strong>require</strong> Factory Girl to complete your setup. Here I’m using RSpec so add the following at the top in <strong>/spec/spec_helper.rb</strong>:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="nb">require</span> <span class="s1">&#39;factory_girl&#39;</span>
</span></code></pre></td></tr></table></div></figure>


<h3>Ruby on Rails</h3>

<p>You are covered of course if you want to use Factory Girl with Rails. The <em>factory_girl_rails</em> gem provides a handy Rails integration for <em>factory_girl</em>.</p>

<p><strong>Shell:</strong></p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>gem install factory_girl_rails
</span></code></pre></td></tr></table></div></figure>


<p><strong>Gemfile:</strong></p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">gem</span> <span class="s2">&quot;factory_girl_rails&quot;</span><span class="p">,</span> <span class="s2">&quot;~&gt; 4.0&quot;</span>
</span></code></pre></td></tr></table></div></figure>


<p>and <strong>require</strong> it of course in <strong>spec/spec_helper.rb</strong>:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="nb">require</span> <span class="s1">&#39;factory_girl_rails&#39;</span>
</span></code></pre></td></tr></table></div></figure>


<h3>Convenient Syntax Setup</h3>

<p>If you prefer typing something like (of course you do)</p>

<p><strong>Ruby:</strong></p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">create</span><span class="p">(</span><span class="ss">:user</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>instead of</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="no">FactoryGirl</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="ss">:user</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>everytime you use one of your factories you just need to include the <code>FactoryGirl::Syntax::Methods</code> module in your test configuration file. If you forget that step, you have to preface all Factory Girl methods with the same verbose preface. This works with any Ruby app, not just with Rails ones of course.</p>

<p>For <strong>RSpec</strong> find the <strong>spec/spec_helper.rb</strong> file and add:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="nb">require</span> <span class="s1">&#39;factory_girl_rails&#39;</span>
</span><span class='line'>
</span><span class='line'><span class="no">RSpec</span><span class="o">.</span><span class="n">configure</span> <span class="k">do</span> <span class="o">|</span><span class="n">config</span><span class="o">|</span>
</span><span class='line'>  <span class="n">config</span><span class="o">.</span><span class="n">include</span> <span class="no">FactoryGirl</span><span class="o">::</span><span class="no">Syntax</span><span class="o">::</span><span class="no">Methods</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<h3>Attention!</h3>

<p>For the newbies among you, beware that the <strong>RSpec.configure</strong> block will already be there—buried under some amount of comments. You can also do the same setup in a separate file of your own—like <strong>spec/support/factory_girl.rb</strong>. In that case you will have to add the whole config block yourself of course.</p>

<p>The same configuration works if you are using other libraries for testing:</p>

<ul>
<li>Test::Unit</li>
<li>Cucumber</li>
<li>Spinach</li>
<li>MiniTest</li>
<li>MiniTest::Spec</li>
<li>minitest-rails</li>
</ul>


<p>You can go more fancy with your configuration by throwing in <strong>DatabaseCleaner</strong> for example but the documentation implies that this setup is sufficient to get going so I’ll move on from here.</p>

<ul>
<li><h3>Defining Factories</h3></li>
</ul>


<p>You can define your factories anywhere but they will be loaded automatically if they are placed in the following locations:</p>

<p><strong>RSpec:</strong></p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>spec/factories.rb
</span><span class='line'>spec/factories/*.rb
</span></code></pre></td></tr></table></div></figure>


<p><strong>Test::Unit:</strong></p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nb">test</span>/factories.rb
</span><span class='line'><span class="nb">test</span>/factories/*.rb
</span></code></pre></td></tr></table></div></figure>


<p>As you can see you have the option to split them into separate files that adhere to whatever logic or bundle your factories together into one big <strong>factories.rb</strong> file. The complexity of your project will be the best guideline for when to logically separate factories into their own separate files.</p>

<h3>Barebones Factories</h3>

<p>Factory Girl provides a well-developed ruby DSL syntax for defining factories like <em>user</em>, <em>post</em> or any other object—not only <em>Active Record</em> objects. “Plain” Ruby classes are perfectly fine. You start by setting up a define block in your <strong>factories.rb</strong> file.</p>

<p><strong>Ruby:</strong></p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="no">FactoryGirl</span><span class="o">.</span><span class="n">define</span> <span class="k">do</span>
</span><span class='line'>  <span class="c1">#define factories here</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>All factories are defined inside this block. Factories just need a <strong>:symbol</strong> name and a set of attributes to get started. This name needs to be the <em>snake_cased</em> version of the Model you want to emulate—like SecretServiceAgent in the following example. The factory below is named <strong>secret_service_agent</strong> and has attributes called <strong>name</strong>, <strong>favorite_gadget</strong> and <strong>skills</strong>.</p>

<p><strong>Ruby:</strong></p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="no">FactoryGirl</span><span class="o">.</span><span class="n">define</span> <span class="k">do</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">factory</span> <span class="ss">:secret_service_agent</span> <span class="k">do</span>
</span><span class='line'>    <span class="nb">name</span> <span class="s2">&quot;Q&quot;</span>
</span><span class='line'>    <span class="n">favorite_gadget</span> <span class="s2">&quot;Submarine Lotus Esprit&quot;</span>
</span><span class='line'>    <span class="n">skills</span> <span class="s2">&quot;Inventing gizmos and hacking&quot;</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<h3>Attention!</h3>

<p>If you take one thing away from this article then it should be the following: Only define the most barebones factory possible in order to be valid by default—valid in the sense of Active Record validations for example. When Factory Girl calls <strong>save!</strong> on instances your validations will get excercised. If any of them fail, <strong>ActiveRecord::RecordInvalid</strong> gets raised. Defining only the bare minimum gives you more flexibility if your data changes and will reduce the chances of breaking tests and duplication—since coupling is reduced to the core. Don’t be lazy when you compose your factories—it will pay off big time!</p>

<p>If you think this sounds hard to manage, you’ll most likely be glad to hear that there are handy solutions in place to segregate objects and their attributes. <strong>Inheritance</strong> and <strong>Traits</strong> will become great allies since they are handy strategies to complement your barebones factories and keep them DRY at the same time. Learn more about <em>Inheritance</em> below and my second article will focus quite a bit on <em>Trails</em>.</p>

<ul>
<li><h3>Using Factories</h3></li>
</ul>


<p>If you have included the <strong>FactoryGirl::Syntax::Methods</strong> in the configuration step you are able to use the shorthand syntax to create factories in your tests. You have four options which people call <em>build strategies</em>:</p>

<ul>
<li><strong>create</strong></li>
</ul>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">create</span><span class="p">(</span><span class="ss">:some_object</span><span class="p">)</span>
</span><span class='line'><span class="c1"># FactoryGirl.create(:some_object)</span>
</span></code></pre></td></tr></table></div></figure>


<p>This one returns an instance of the class the factory emulates. It is recommended to use <strong>create</strong> only when you really need to hit the database. This strategy slows down your test suite if overused unnecessarily. Use it if you want to run your validations since it will run <strong>save!</strong> in the background. I think this option is mostly appropriate when you do integration tests where you want to involve a database for your test scenarios.</p>

<ul>
<li><strong>build</strong></li>
</ul>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">build</span><span class="p">(</span><span class="ss">:some_object</span><span class="p">)</span>
</span><span class='line'><span class="c1"># FactoryGirl.build(:some_object)</span>
</span></code></pre></td></tr></table></div></figure>


<p>It instantiates and assigns attributes but you’ll get an instance returned that is not saved to the database—<strong>build</strong> keeps the object only in memory. If you want to check if an object has certain attributes this will do the job since you don’t need database access for that kinda thing. Behind the scenes it does not use <strong>save!</strong> which means your validations are not run.</p>

<h3>Heads up!</h3>

<p>When you use associations with it you might run into a small gotcha. There is a little exception in regards to not saving the object via <strong>build</strong>—it <em>builds</em> the object but it <em>creates</em> the associations—which I will cover in the section about Factory Girl associations. There is a solution for that in case that’s not what you were shopping for.</p>

<ul>
<li><strong>build_stubbed</strong></li>
</ul>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">build_stubbed</span><span class="p">(</span><span class="ss">:some_object</span><span class="p">)</span>
</span><span class='line'><span class="c1"># FactoryGirl.build_stubbed(:some_object)</span>
</span></code></pre></td></tr></table></div></figure>


<p>This option was created for speeding up your tests and for test cases where none of the code needs to hit the database. It also instantiates and assigns attributes like <strong>build</strong> does but it only makes objects look like they have been persisted. The object returned has all the defined attributes from your factory stubbed out—plus a fake <strong>id</strong> and <strong>nil</strong> timestamps. Their associations are stubbed out as well—unlike <strong>build</strong> associations which are using <strong>create</strong> on associated objects. Since this strategy is dealing with stubs and has no dependency on the database these tests will be as fast as they get.</p>

<ul>
<li><strong>attributes_for</strong></li>
</ul>


<p>This method will return a hash of only the attributes defined in the relevant factory—without associations, timestamps and id of course. Its sort of convenient if you want to build an instance of an object without fiddling around with attribute hashes manually. I have seen it mostly used in Controller specs similar to this:</p>

<p><strong>Ruby:</strong></p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">it</span> <span class="s1">&#39;redirects to some location&#39;</span> <span class="k">do</span>
</span><span class='line'>  <span class="n">post</span> <span class="ss">:create</span><span class="p">,</span> <span class="ss">spy</span><span class="p">:</span> <span class="n">attributes_for</span><span class="p">(</span><span class="ss">:spy</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">expect</span><span class="p">(</span><span class="n">response</span><span class="p">)</span><span class="o">.</span><span class="n">to</span> <span class="n">redirect_to</span><span class="p">(</span><span class="n">some_location</span><span class="p">)</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<h3>Object comparison</h3>

<p>To close this section, let me give you one simple example to see the different objects returned from these four build strategies. Below you can compare the four different objects that you’ll get from <strong>attributes_for</strong>, <strong>create</strong>, <strong>build</strong> and <strong>build_stubbed</strong>:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="no">FactoryGirl</span><span class="o">.</span><span class="n">define</span> <span class="k">do</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">factory</span> <span class="ss">:spy</span> <span class="k">do</span>
</span><span class='line'>    <span class="nb">name</span> <span class="s2">&quot;Marty McSpy&quot;</span>
</span><span class='line'>    <span class="n">favorite_gadget</span> <span class="s2">&quot;Hoverboard&quot;</span>
</span><span class='line'>    <span class="n">skills</span> <span class="s2">&quot;Infiltration and espionage&quot;</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">attributes_for</span><span class="p">(</span><span class="ss">:spy</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'><span class="c1">#returned object</span>
</span><span class='line'><span class="p">{</span><span class="ss">:name</span><span class="o">=&gt;</span><span class="s2">&quot;Marty McSpy&quot;</span><span class="p">,</span> <span class="ss">:favorite_gadget</span><span class="o">=&gt;</span><span class="s2">&quot;Hoverboard&quot;</span><span class="p">,</span> <span class="ss">:skills</span><span class="o">=&gt;</span><span class="s2">&quot;Infiltration and espionage&quot;</span><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">create</span><span class="p">(</span><span class="ss">:spy</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'><span class="c1">#returned object</span>
</span><span class='line'><span class="o">&lt;</span><span class="no">Spy</span> <span class="nb">id</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="nb">name</span><span class="p">:</span> <span class="s2">&quot;Marty McSpy&quot;</span><span class="p">,</span> <span class="ss">favorite_gadget</span><span class="p">:</span> <span class="s2">&quot;Hoverboard&quot;</span><span class="p">,</span> <span class="ss">skills</span><span class="p">:</span> <span class="s2">&quot;Infiltration and espionage&quot;</span><span class="p">,</span> <span class="ss">created_at</span><span class="p">:</span> <span class="s2">&quot;2015-10-17 16:40:09&quot;</span><span class="p">,</span> <span class="ss">updated_at</span><span class="p">:</span> <span class="s2">&quot;2015-10-17 16:40:09&quot;</span><span class="o">&gt;</span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">build</span><span class="p">(</span><span class="ss">:spy</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'><span class="c1">#returned object</span>
</span><span class='line'><span class="o">&lt;</span><span class="no">Spy</span> <span class="nb">id</span><span class="p">:</span> <span class="kp">nil</span><span class="p">,</span> <span class="nb">name</span><span class="p">:</span> <span class="s2">&quot;Marty McSpy&quot;</span><span class="p">,</span> <span class="ss">favorite_gadget</span><span class="p">:</span> <span class="s2">&quot;Hoverboard&quot;</span><span class="p">,</span> <span class="ss">skills</span><span class="p">:</span> <span class="s2">&quot;Infiltration and espionage&quot;</span><span class="p">,</span> <span class="ss">created_at</span><span class="p">:</span> <span class="kp">nil</span><span class="p">,</span> <span class="ss">updated_at</span><span class="p">:</span> <span class="kp">nil</span><span class="o">&gt;</span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">build_stubbed</span><span class="p">(</span><span class="ss">:spy</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'><span class="c1">#returned object</span>
</span><span class='line'><span class="o">&lt;</span><span class="no">Spy</span> <span class="nb">id</span><span class="p">:</span> <span class="mi">1001</span><span class="p">,</span> <span class="nb">name</span><span class="p">:</span> <span class="s2">&quot;Marty McSpy&quot;</span><span class="p">,</span> <span class="ss">favorite_gadget</span><span class="p">:</span> <span class="s2">&quot;Hoverboard&quot;</span><span class="p">,</span> <span class="ss">skills</span><span class="p">:</span> <span class="s2">&quot;Infiltration and espionage&quot;</span><span class="p">,</span> <span class="ss">created_at</span><span class="p">:</span> <span class="kp">nil</span><span class="p">,</span> <span class="ss">updated_at</span><span class="p">:</span> <span class="kp">nil</span><span class="o">&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>Hope this was helpful if there was still some confusion left how they work and when to use what option.</p>

<ul>
<li><h3>Inheritance</h3></li>
</ul>


<p>You’re gonna love this one! With inheritance you can define factories only with the necessary attributes that each class needs for creation. This parent factory can spawn as many “child” factories as you see fit to cover all kinds of test scenarios with varying data sets. Keeping your test data DRY is very important and inheritance makes this a lot more easy for you.</p>

<p>Say you wanna define a couple of core attributes on a factory and within that same factory have different factories for the same <strong>Class</strong> with different attributes. In the example below you can see how you can avoid repeating attributes by just nesting your factories. Let’s emulate a <strong>Spy</strong> class that needs to adapt to three different test scenarios.</p>

<p><strong>factories.rb</strong></p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="no">FactoryGirl</span><span class="o">.</span><span class="n">define</span> <span class="k">do</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">factory</span> <span class="ss">:spy</span> <span class="k">do</span>
</span><span class='line'>    <span class="nb">name</span> <span class="s1">&#39;Marty McSpy&#39;</span>
</span><span class='line'>    <span class="n">licence_to_kill</span> <span class="kp">false</span>
</span><span class='line'>    <span class="n">skills</span> <span class="s1">&#39;Espionage and intelligence&#39;</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">factory</span> <span class="ss">:quartermaster</span> <span class="k">do</span>
</span><span class='line'>      <span class="nb">name</span> <span class="s1">&#39;Q&#39;</span>
</span><span class='line'>      <span class="n">skills</span> <span class="s1">&#39;Inventing gizmos and hacking&#39;</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">factory</span> <span class="ss">:bond</span> <span class="k">do</span>
</span><span class='line'>      <span class="nb">name</span> <span class="s1">&#39;James Bond&#39;</span>
</span><span class='line'>      <span class="n">licence_to_kill</span> <span class="kp">true</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p><strong>some_spec.rb</strong></p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">bond</span> <span class="o">=</span> <span class="n">create</span><span class="p">(</span><span class="ss">:bond</span><span class="p">)</span>
</span><span class='line'><span class="n">quartermaster</span> <span class="o">=</span> <span class="n">create</span><span class="p">(</span><span class="ss">:quartermaster</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'><span class="n">quartermaster</span><span class="o">.</span><span class="n">name</span> <span class="c1"># =&gt; &#39;Q&#39;</span>
</span><span class='line'><span class="n">quartermaster</span><span class="o">.</span><span class="n">skills</span> <span class="c1"># =&gt; &#39;Inventing gizmos and hacking&#39;</span>
</span><span class='line'><span class="n">quartermaster</span><span class="o">.</span><span class="n">licence_to_kill</span> <span class="c1"># =&gt; false</span>
</span><span class='line'>
</span><span class='line'><span class="n">bond</span><span class="o">.</span><span class="n">name</span> <span class="c1"># =&gt; &#39;James Bond&#39;</span>
</span><span class='line'><span class="n">bond</span><span class="o">.</span><span class="n">skills</span> <span class="c1"># =&gt; &#39;Espionage and intelligence&#39;</span>
</span><span class='line'><span class="n">bond</span><span class="o">.</span><span class="n">licence_to_kill</span> <span class="c1"># =&gt; true</span>
</span></code></pre></td></tr></table></div></figure>


<p>As you can observe, the <strong>:bond</strong> and <strong>:quartermaster</strong> factories inherit attributes from their parent <strong>:spy</strong>. At the same time you can easily overwrite attributes as needed and be very expressive about it via their factory names. Imagine all the lines of code saved because you don’t have to repeat the same basic setup if you want to test different states or related objects. That feature alone is worth using Factory Girl and makes it hard to go back to YAML fixtures.</p>

<p>If you want to avoid nesting factory definitions you can also link factories to their parent explicitly by providing a <strong>parent</strong> hash:</p>

<p><strong>factories.rb</strong></p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">factory</span> <span class="ss">:spy</span> <span class="k">do</span>
</span><span class='line'>  <span class="nb">name</span> <span class="s1">&#39;Marty McSpy&#39;</span>
</span><span class='line'>  <span class="n">licence_to_kill</span> <span class="kp">false</span>
</span><span class='line'>  <span class="n">skills</span> <span class="s1">&#39;Espionage and intelligence&#39;</span>
</span><span class='line'><span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="n">factory</span> <span class="ss">:bond</span><span class="p">,</span> <span class="ss">parent</span><span class="p">:</span> <span class="ss">:spy</span> <span class="k">do</span>
</span><span class='line'>  <span class="nb">name</span> <span class="s1">&#39;James Bond&#39;</span>
</span><span class='line'>  <span class="n">licence_to_kill</span> <span class="kp">true</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>Same functionality and almost as DRY.</p>

<ul>
<li><h3>Multiple Records</h3></li>
</ul>


<p>Here is a small but nevertheless welcome addtion to Factory Girl that makes dealing with lists easy as pie:</p>

<ul>
<li><strong>build_list</strong></li>
<li><strong>create_list</strong></li>
</ul>


<p>Every once in a while in situations where you want to have multiple instances of some factory without much fuzz, these will come in handy. Both methods will return an array with the amount of factory items specified. Pretty neat right?</p>

<p><strong>Ruby:</strong></p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">spy_clones</span> <span class="o">=</span> <span class="n">create_list</span><span class="p">(</span><span class="ss">:spy</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'><span class="n">fake_spies</span> <span class="o">=</span> <span class="n">build_list</span><span class="p">(</span><span class="ss">:spy</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'><span class="n">spy_clones</span> <span class="c1"># =&gt; [#&lt;Spy id: 1, name: \&quot;Marty McSpy\&quot;, function: \&quot;Covert agent\&quot;, skills: \&quot;Infiltration and espionage\&quot;, created_at: \&quot;2015-10-18 18:52:02\&quot;, updated_at: \&quot;2015-10-18 18:52:02\&quot;&gt;, #&lt;Spy id: 2, name: \&quot;Marty McSpy\&quot;, function: \&quot;Covert agent\&quot;, skills: \&quot;Infiltration and espionage\&quot;, created_at: \&quot;2015-10-18 18:52:02\&quot;, updated_at: \&quot;2015-10-18 18:52:02\&quot;&gt;, #&lt;Spy id: 3, name: \&quot;Marty McSpy\&quot;, function: \&quot;Covert agent\&quot;, skills: \&quot;Infiltration and espionage\&quot;, created_at: \&quot;2015-10-18 18:52:02\&quot;, updated_at: \&quot;2015-10-18 18:52:02\&quot;&gt;]</span>
</span><span class='line'>
</span><span class='line'><span class="n">fake_spies</span> <span class="c1"># =&gt; [#&lt;Spy id: nil, name: \&quot;Marty McSpy\&quot;, function: \&quot;Covert agent\&quot;, skills: \&quot;Infiltration and espionage\&quot;, created_at: nil, updated_at: nil&gt;, #&lt;Spy id: nil, name: \&quot;Marty McSpy\&quot;, function: \&quot;Covert agent\&quot;, skills: \&quot;Infiltration and espionage\&quot;, created_at: nil, updated_at: nil&gt;, #&lt;Spy id: nil, name: \&quot;Marty McSpy\&quot;, function: \&quot;Covert agent\&quot;, skills: \&quot;Infiltration and espionage\&quot;, created_at: nil, updated_at: nil&gt;]</span>
</span></code></pre></td></tr></table></div></figure>


<p>Subtle differences between the two options, but I’m sure you understand them by now. I should also mention that you can provide both methods with a hash of attributes if you want to overwrite factory attributes on the fly for some reason. Timewise, the overwrites will eat a bit of your testing speed if you create lots of test data with that have overwrites. Probably having a separate factory with these attributes changed will be a better option for creating lists.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">smug_spies</span> <span class="o">=</span> <span class="n">create_list</span><span class="p">(</span><span class="ss">:spy</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="ss">skills</span><span class="p">:</span> <span class="s1">&#39;Smug jokes&#39;</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'><span class="n">double_agents</span> <span class="o">=</span> <span class="n">build_list</span><span class="p">(</span><span class="ss">:spy</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="nb">name</span><span class="p">:</span> <span class="s1">&#39;Vesper Lynd&#39;</span><span class="p">,</span> <span class="ss">skills</span><span class="p">:</span> <span class="s1">&#39;Seduction and bookkeeping&#39;</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'><span class="n">smug_spies</span> <span class="c1"># =&gt; [#&lt;Spy id: 1, name: \&quot;Marty McSpy\&quot;, function: \&quot;Covert agent\&quot;, skills: \&quot;Smug jokes\&quot;, created_at: \&quot;2015-10-18 19:08:07\&quot;, updated_at: \&quot;2015-10-18 19:08:07\&quot;&gt;, #&lt;Spy id: 2, name: \&quot;Marty McSpy\&quot;, function: \&quot;Covert agent\&quot;, skills: \&quot;Smug jokes\&quot;, created_at: \&quot;2015-10-18 19:08:07\&quot;, updated_at: \&quot;2015-10-18 19:08:07\&quot;&gt;, #&lt;Spy id: 3, name: \&quot;Marty McSpy\&quot;, function: \&quot;Covert agent\&quot;, skills: \&quot;Smug jokes\&quot;, created_at: \&quot;2015-10-18 19:08:07\&quot;, updated_at: \&quot;2015-10-18 19:08:07\&quot;&gt;]</span>
</span><span class='line'>
</span><span class='line'><span class="n">double_agents</span> <span class="c1"># =&gt; [#&lt;Spy id: nil, name: \&quot;Vesper Lynd\&quot;, function: \&quot;Covert agent\&quot;, skills: \&quot;Seduction and bookkeeping\&quot;, created_at: nil, updated_at: nil&gt;, #&lt;Spy id: nil, name: \&quot;Vesper Lynd\&quot;, function: \&quot;Covert agent\&quot;, skills: \&quot;Seduction and bookkeeping\&quot;, created_at: nil, updated_at: nil&gt;, #&lt;Spy id: nil, name: \&quot;Vesper Lynd\&quot;, function: \&quot;Covert agent\&quot;, skills: \&quot;Seduction and bookkeeping\&quot;, created_at: nil, updated_at: nil&gt;] </span>
</span></code></pre></td></tr></table></div></figure>


<p>You’ll frequently need a pair of objects and therefore Factory Girl provides you another two options:</p>

<ul>
<li><strong>build_pair</strong></li>
<li><strong>create_pair</strong></li>
</ul>


<p>Same idea as above but the returned array holds only two records at a time.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">create_pair</span><span class="p">(</span><span class="ss">:spy</span><span class="p">)</span>
</span><span class='line'> <span class="c1"># =&gt; [#&lt;Spy id: 1, name: \&quot;Marty McSpy\&quot;, function: \&quot;Covert agent\&quot;, skills: \&quot;Infiltration and espionage\&quot;, created_at: \&quot;2015-10-18 19:31:41\&quot;, updated_at: \&quot;2015-10-18 19:31:41\&quot;&gt;, #&lt;Spy id: 2, name: \&quot;Marty McSpy\&quot;, function: \&quot;Covert agent\&quot;, skills: \&quot;Infiltration and espionage\&quot;, created_at: \&quot;2015-10-18 19:31:41\&quot;, updated_at: \&quot;2015-10-18 19:31:41\&quot;&gt;]</span>
</span><span class='line'>
</span><span class='line'><span class="n">build_pair</span><span class="p">(</span><span class="ss">:spy</span><span class="p">)</span>
</span><span class='line'> <span class="c1"># =&gt; [#&lt;Spy id: nil, name: \&quot;Marty McSpy\&quot;, function: \&quot;Covert agent\&quot;, skills: \&quot;Infiltration and espionage\&quot;, created_at: nil, updated_at: nil&gt;, #&lt;Spy id: nil, name: \&quot;Marty McSpy\&quot;, function: \&quot;Covert agent\&quot;, skills: \&quot;Infiltration and espionage\&quot;, created_at: nil, updated_at: nil&gt;]</span>
</span></code></pre></td></tr></table></div></figure>


<ul>
<li><h3>Sequences</h3></li>
</ul>


<p>If you thought naming spies could be less static you are absolutly right. In this final section we’ll look at creating sequential unique values as test data for your factory attributes. When might this be useful? What about unique email addresses for testing authentication or unique usernames for example? That’s where sequences shine. Let’s look at a couple of different ways you can make use of <strong>sequence</strong>:</p>

<ul>
<li><strong>“global” sequence</strong></li>
</ul>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="no">FactoryGirl</span><span class="o">.</span><span class="n">define</span> <span class="k">do</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">sequence</span> <span class="ss">:spy_email</span> <span class="k">do</span> <span class="o">|</span><span class="n">n</span><span class="o">|</span>
</span><span class='line'>    <span class="s2">&quot;00</span><span class="si">#{</span><span class="n">n</span><span class="si">}</span><span class="s2">@mi6.com&quot;</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">factory</span> <span class="ss">:spy</span> <span class="k">do</span>
</span><span class='line'>    <span class="nb">name</span> <span class="s1">&#39;Marty McSpy&#39;</span>
</span><span class='line'>    <span class="n">email</span> <span class="s1">&#39;marty@thepinheads.com&#39;</span>
</span><span class='line'>    <span class="n">skills</span> <span class="s1">&#39;Espionage and infiltration&#39;</span>
</span><span class='line'>    <span class="n">license_to_kill</span> <span class="kp">false</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>    <span class="n">factory</span> <span class="ss">:elite_spy</span> <span class="k">do</span>
</span><span class='line'>      <span class="nb">name</span> <span class="s1">&#39;Edward Donne&#39;</span>
</span><span class='line'>      <span class="n">license_to_kill</span> <span class="kp">true</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="n">top_spy</span> <span class="o">=</span> <span class="n">create</span><span class="p">(</span><span class="ss">:elite_spy</span><span class="p">)</span>
</span><span class='line'><span class="n">top_spy</span><span class="o">.</span><span class="n">email</span> <span class="o">=</span> <span class="n">generate</span><span class="p">(</span><span class="ss">:spy_email</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'><span class="n">top_spy</span><span class="o">.</span><span class="n">email</span>
</span><span class='line'><span class="c1"># =&gt; &quot;001@mi6.com&quot;</span>
</span></code></pre></td></tr></table></div></figure>


<p>Since this sequence is defined “globally” for all your factories—it does not belong to one specifice factory—you can use this sequence generator for all your factories wherever you need a <strong>:spy_email</strong>. <strong>generate</strong> and the name of your sequence is all you need.</p>

<ul>
<li><strong>attributes</strong></li>
</ul>


<p>As a small variation that is super convenient I’m gonna show you how to directly assign sequences as attributes to your factories. Same condition as above where your sequence is defined “globally”. In the case of a factory definition you can leave off the <strong>generate</strong> method call and Factory Girl will assign the returned value from the sequence directly to the attribute of the same name. Neat!</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="no">FactoryGirl</span><span class="o">.</span><span class="n">define</span> <span class="k">do</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">sequence</span> <span class="ss">:email</span> <span class="k">do</span> <span class="o">|</span><span class="n">n</span><span class="o">|</span>
</span><span class='line'>    <span class="s2">&quot;00</span><span class="si">#{</span><span class="n">n</span><span class="si">}</span><span class="s2">@mi6.com&quot;</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">factory</span> <span class="ss">:secret_service_agent</span> <span class="k">do</span>
</span><span class='line'>    <span class="nb">name</span> <span class="s1">&#39;Edwad Donne&#39;</span>
</span><span class='line'>    <span class="n">email</span>
</span><span class='line'>    <span class="n">skills</span> <span class="s1">&#39;Espionage and infiltration&#39;</span>
</span><span class='line'>    <span class="n">license_to_kill</span> <span class="kp">true</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<ul>
<li><strong>lazy attributes</strong></li>
</ul>


<p>You can also use a <strong>sequence</strong> on <em>lazy attributes</em>. I will cover this topic in my second article but for completeness sake I wanted to mention it here as well. In case you need a unique value assigned at the time the instance gets created—therefore its called <em>lazy</em> because this attribute waits with value assignment until object instantiation—sequences just need a block to work as well.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="no">FactoryGirl</span><span class="o">.</span><span class="n">define</span> <span class="k">do</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">sequence</span> <span class="ss">:mission_deployment</span> <span class="k">do</span> <span class="o">|</span><span class="n">number</span><span class="o">|</span>
</span><span class='line'>    <span class="s2">&quot;Mission </span><span class="si">#{</span><span class="n">number</span><span class="si">}</span><span class="s2"> at </span><span class="si">#{</span><span class="no">DateTime</span><span class="o">.</span><span class="n">now</span><span class="o">.</span><span class="n">to_formatted_s</span><span class="p">(</span><span class="ss">:short</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">factory</span> <span class="ss">:spy</span> <span class="k">do</span>
</span><span class='line'>    <span class="nb">name</span> <span class="s1">&#39;Marty McSpy&#39;</span>
</span><span class='line'>    <span class="n">deployment</span> <span class="p">{</span> <span class="n">generate</span><span class="p">(</span><span class="ss">:mission_deployment</span><span class="p">)</span> <span class="p">}</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="n">some_spy</span> <span class="o">=</span> <span class="n">create</span><span class="p">(</span><span class="ss">:spy</span><span class="p">)</span>
</span><span class='line'><span class="n">some_spy</span><span class="o">.</span><span class="n">deployment</span> <span class="c1"># =&gt; &quot;Mission #1 at 19 Oct 21:13&quot;</span>
</span></code></pre></td></tr></table></div></figure>


<p>The block for the factory attribute gets evaluated when the object gets instantiated. In our case, you’ll get a string composed of a unique mission number and a new <strong>DateTime</strong> object as values for every <strong>:spy</strong> that gets deployed.</p>

<ul>
<li><strong>in-line sequence</strong></li>
</ul>


<p>This option is best when a sequence of unique values is only needed on an attribute for a single factory. It would make no sense to define it outside that factory and possibly have to look for it elsewhere if you need to tweak it. In the example below we are looking to generate unique ids for every spy car.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="no">FactoryGirl</span><span class="o">.</span><span class="n">define</span> <span class="k">do</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">factory</span> <span class="ss">:aston_martin</span> <span class="k">do</span>
</span><span class='line'>    <span class="n">sequence</span><span class="p">(</span><span class="ss">:vehicle_id_number</span><span class="p">)</span> <span class="p">{</span><span class="o">|</span><span class="n">n</span><span class="o">|</span> <span class="s2">&quot;A_M_</span><span class="si">#{</span><span class="n">n</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">}</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="n">spycar_01</span> <span class="o">=</span> <span class="n">create</span><span class="p">(</span><span class="ss">:aston_martin</span><span class="p">)</span>
</span><span class='line'><span class="n">spycar_01</span><span class="o">.</span><span class="n">vehicle_id_number</span>
</span><span class='line'><span class="c1"># =&gt; &quot;A_M_1&quot;</span>
</span><span class='line'>
</span><span class='line'><span class="n">spycar_02</span> <span class="o">=</span> <span class="n">create</span><span class="p">(</span><span class="ss">:aston_martin</span><span class="p">)</span>
</span><span class='line'><span class="n">spycar_02</span><span class="o">.</span><span class="n">vehicle_id_number</span>
</span><span class='line'><span class="c1"># =&gt; &quot;A_M_2&quot;</span>
</span></code></pre></td></tr></table></div></figure>


<p>Well, maybe we should provide the <strong>vehicle_id_number</strong> attribute another starting value than <strong>1</strong>? Let’s say we wanna account for a couple of prototypes before the car was ready for production. You can provide a second argument as the starting value for your sequence. Let’s go with <strong>9</strong> this time.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="no">FactoryGirl</span><span class="o">.</span><span class="n">define</span> <span class="k">do</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">factory</span> <span class="ss">:aston_martin</span> <span class="k">do</span>
</span><span class='line'>    <span class="n">sequence</span><span class="p">(</span><span class="ss">:vehicle_id_number</span><span class="p">,</span> <span class="mi">9</span><span class="p">)</span> <span class="p">{</span><span class="o">|</span><span class="n">n</span><span class="o">|</span> <span class="s2">&quot;A_M_</span><span class="si">#{</span><span class="n">n</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">}</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="n">spycar_01</span> <span class="o">=</span> <span class="n">create</span><span class="p">(</span><span class="ss">:aston_martin</span><span class="p">)</span>
</span><span class='line'><span class="n">spycar_01</span><span class="o">.</span><span class="n">vehicle_id_number</span>
</span><span class='line'><span class="c1"># =&gt; &quot;A_M_9&quot;</span>
</span><span class='line'>
</span><span class='line'><span class="n">spycar_02</span> <span class="o">=</span> <span class="n">create</span><span class="p">(</span><span class="ss">:aston_martin</span><span class="p">)</span>
</span><span class='line'><span class="n">spycar_02</span><span class="o">.</span><span class="n">vehicle_id_number</span>
</span><span class='line'><span class="c1"># =&gt; &quot;A_M_10&quot;</span>
</span><span class='line'>
</span><span class='line'><span class="c1"># ...</span>
</span></code></pre></td></tr></table></div></figure>


<ul>
<li><h3>Closing Thoughts</h3></li>
</ul>


<p>As you have seen by now, Factory Girl offers a well balanced Ruby DSL  that builds objects instead of Database Records for your test data. It helps to keep your tests focused, DRY and readable when you deal with dummy data. That’s a pretty solid accomplishment in my book. Remember that barebones factory definitions are key to your future sanity. The more factory data you put in your global test space the more likely you’ll experience some sort of maintainance pain. For your unit tests, Factory Girl will be unnecessary and only slows down your test suite. Josh Clayton would be the first to attest to this and who would recommend its best practice to use Factory Girl selectively and as little as possible.</p>
</div>
  
  


    </article>
  
  <div class="pagination">
    
    <a href="/octopress_drafts_previewer/blog/archives">Blog Archives</a>
    
  </div>
</div>
<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/octopress_drafts_previewer/blog/2015/10/26/Page-Objects/">Ruby Page Objects for Capybara Connoisseurs</a>
      </li>
    
      <li class="post">
        <a href="/octopress_drafts_previewer/blog/2015/10/20/Factory-Girl-Guide-02/">Factory Girl 201</a>
      </li>
    
      <li class="post">
        <a href="/octopress_drafts_previewer/blog/2015/10/12/Factory-Girl-Guide-01/">Factory Girl 101</a>
      </li>
    
  </ul>
</section>





  
</aside>

    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2015 - Your Name -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  







  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = '//platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
