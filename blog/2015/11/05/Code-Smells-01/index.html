
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Ruby / Rails Code Smells 01 - Drafts Previewer</title>
  <meta name="author" content="Your Name">

  
  <meta name="description" content="Topics Smelly Code
Large Class / God Class
Long Method
Smelly Code The following short series of articles is meant for slightly experienced Ruby &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://vis-kid.github.io/octopress_drafts_previewer/blog/2015/11/05/Code-Smells-01/">
  <link href="/octopress_drafts_previewer/favicon.png" rel="icon">
  <link href="/octopress_drafts_previewer/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/octopress_drafts_previewer/atom.xml" rel="alternate" title="Drafts Previewer" type="application/atom+xml">
  <script src="/octopress_drafts_previewer/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="/javascripts/libs/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/octopress_drafts_previewer/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="//fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="//fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  

</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/octopress_drafts_previewer/">Drafts Previewer</a></h1>
  
    <h2>Simple way to share my drafts for feedback</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/octopress_drafts_previewer/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="https://www.google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="sitesearch" value="vis-kid.github.io/octopress_drafts_previewer">
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/octopress_drafts_previewer/">Blog</a></li>
  <li><a href="/octopress_drafts_previewer/blog/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">Ruby / Rails Code Smells 01</h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2015-11-05T04:29:10+01:00'><span class='date'><span class='date-month'>Nov</span> <span class='date-day'>5</span><span class='date-suffix'>th</span>, <span class='date-year'>2015</span></span> <span class='time'>4:29 am</span></time>
        
      </p>
    
  </header>


<div class="entry-content"><p><img src="/octopress_drafts_previewer/images/code_smells/code_smell_01.jpeg"></p>

<h3>Topics</h3>

<ul>
<li>Smelly Code</li>
<li>Large Class / God Class</li>
<li><p>Long Method</p></li>
<li><h3>Smelly Code</h3></li>
</ul>


<p>The following short series of articles is meant for slightly experienced Ruby developers and starters alike. I had the impression that code smells and their refactorings can be very daunting and intimidating to newbies—especially if they are not in the fortunate position to have mentors who can turn mystical programming concepts into shining light bulbs.</p>

<p>So what are we talking about exactly when people mention code smells? Is it always a problem in your code? Not necessarily! Can you avoid them completely? I don’t think so! Do you mean code smells lead to broken code? Well, sometimes and sometimes not. Should it be my priority to fix them right away? Same answer I fear, sometimes yes and sometimes you certainly should fry bigger fish first. Are you insane? Fair question at this point! Before you continue diving into this whole smelly business, remember to take away one thing from all of this: Don’t try to fix every smell you encounter—this is most certainly a waste of your time!</p>

<p>It seems to me that code smells are a bit hard to wrap up in a nicely labeled box. There are all kinds of smells with various different options to address them. Also, different programming languages and frameworks are prone to different kind of smells—but there are definitely a lot of common “genetic” strains among them. My attempt to describe code smells is to compare them with medical symptoms that tell you that you might have a problem. They can point to all sorts of latent problems and have a wide variety of solutions if diagnosed.</p>

<p>Thankfully they’re overall not as complicated as dealing with the human body—and psyche of course. Its a fair comparison though because some of these symptoms need to be treated right away and some others give you ample time to come up with a solution that is best for the “patient’s” overall well-being. If you have working code and you run into something smelly you’ll have to make the hard decision if its worth the time to find a fix and if that refactoring improves the stability of your app. That being said, if you stumble upon code which you can improve right away its good advice to leave the code behind a bit better than before—even a tiny bit better adds up substantially over time.</p>

<h4>Resistance</h4>

<p>The quality of your code becomes questionable if the inclusion of new code becomes harder—like deciding where to put new code is a pain or comes with a lot of ripple effects throughout your codebase for example. This is called resistance. As a guideline for code quality you can measure it always by how easy it is to introduce changes. If that is getting harder and harder its definitely time to refactor and to take the last part of <em>red-green-REFACTOR</em> more seriously in the future.</p>

<ul>
<li><h3>Large Class / God Class</h3></li>
</ul>


<p>Let’s start with something fancy sounding—“God classes”—because I think they are particular easy to grasp for beginners. God classes are a special case of a code smell called <strong>Large Class</strong>. In this section I’ll address both of them. If you have spent a little bit of time in Rails land you probably have seen them so often that they look normal to you.</p>

<p>You surely remember the “fat models, skinny controller” mantra? Well actually, skinny is good for all these classes but as a guideline its good advice for newbies I suppose. God classes are objects that attract all sorts of knowledge and behaviour like a black hole. Your usual suspects most often include the User model and whatever problem (hopefully ;) your app is trying to solve—first and foremost at least. A todo app might bulk up on the <strong>Todos</strong> model, a shopping app on <strong>Products</strong>, a photo app on <strong>Photos</strong>—you get the drift. People call them god classes because they know too much. They have too many connections with other classes—mostly because someone was modeling them lazily. It is hard work though to keep God classes in check. They make it really easy to dump more responsibilities onto them and as lots of greek heroes would attest, it takes a bit of skill to divide and conquer “gods”.</p>

<p>The problem with them is that they become harder and harder to understand, especially for new team members, harder to change and reuse becomes less and less of an option the more gravity they’ve amassed. Oh yeah, you’re right, your tests are unnecessarily harder to write as well. In short, there is not really an upside to having large classes and god classes in particular.</p>

<p>There are a couple of common symptoms / signs that your class needs some heroism / surgery:</p>

<ul>
<li>You need to scroll!</li>
<li>Tons of private methods?</li>
<li>Does your class have seven or more methods on it?</li>
<li>Hard to tell what your class really does—concisely!</li>
<li>Does your class have many reasons to change when your code evolves?</li>
</ul>


<p>Also, if you squint at your class and think “Eh? Ew!” you might be on to something too. If all that sounds familiar, chances are good that you found yourself a fine specimen.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">class</span> <span class="nc">CastingInviter</span>
</span><span class='line'>  <span class="no">EMAIL_REGEX</span> <span class="o">=</span> <span class="sr">/\A([^@\s]+)@((?:[-a-z0-9]+\.)+[a-z]{2,})\z/</span>
</span><span class='line'>
</span><span class='line'>  <span class="kp">attr_reader</span> <span class="ss">:message</span><span class="p">,</span> <span class="ss">:invitees</span><span class="p">,</span> <span class="ss">:casting</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="n">attributes</span> <span class="o">=</span> <span class="p">{})</span>
</span><span class='line'>    <span class="vi">@message</span>  <span class="o">=</span> <span class="n">attributes</span><span class="o">[</span><span class="ss">:message</span><span class="o">]</span>  <span class="o">||</span> <span class="s1">&#39;&#39;</span>
</span><span class='line'>    <span class="vi">@invitees</span> <span class="o">=</span> <span class="n">attributes</span><span class="o">[</span><span class="ss">:invitees</span><span class="o">]</span> <span class="o">||</span> <span class="s1">&#39;&#39;</span>
</span><span class='line'>    <span class="vi">@sender</span>   <span class="o">=</span> <span class="n">attributes</span><span class="o">[</span><span class="ss">:sender</span><span class="o">]</span>
</span><span class='line'>    <span class="vi">@casting</span>  <span class="o">=</span> <span class="n">attributes</span><span class="o">[</span><span class="ss">:casting</span><span class="o">]</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">valid?</span>
</span><span class='line'>    <span class="n">valid_message?</span> <span class="o">&amp;&amp;</span> <span class="n">valid_invitees?</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">deliver</span>
</span><span class='line'>    <span class="k">if</span> <span class="n">valid?</span>
</span><span class='line'>      <span class="n">invitee_list</span><span class="o">.</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">email</span><span class="o">|</span>
</span><span class='line'>        <span class="n">invitation</span> <span class="o">=</span> <span class="n">create_invitation</span><span class="p">(</span><span class="n">email</span><span class="p">)</span>
</span><span class='line'>        <span class="no">Mailer</span><span class="o">.</span><span class="n">invitation_notification</span><span class="p">(</span><span class="n">invitation</span><span class="p">,</span> <span class="vi">@message</span><span class="p">)</span>
</span><span class='line'>      <span class="k">end</span>
</span><span class='line'>    <span class="k">else</span>
</span><span class='line'>      <span class="n">failure_message</span>  <span class="o">=</span> <span class="s2">&quot;Your </span><span class="si">#{</span> <span class="vi">@casting</span> <span class="si">}</span><span class="s2"> message couldn’t be sent. Invitees emails or message are invalid&quot;</span>
</span><span class='line'>      <span class="n">invitation</span> <span class="o">=</span> <span class="n">create_invitation</span><span class="p">(</span><span class="vi">@sender</span><span class="p">)</span>
</span><span class='line'>      <span class="no">Mailer</span><span class="o">.</span><span class="n">invitation_notification</span><span class="p">(</span><span class="n">invitation</span><span class="p">,</span> <span class="n">failure_message</span> <span class="p">)</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="kp">private</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">invalid_invitees</span>
</span><span class='line'>    <span class="vi">@invalid_invitees</span> <span class="o">||=</span> <span class="n">invitee_list</span><span class="o">.</span><span class="n">map</span> <span class="k">do</span> <span class="o">|</span><span class="n">item</span><span class="o">|</span>
</span><span class='line'>      <span class="k">unless</span> <span class="n">item</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="no">EMAIL_REGEX</span><span class="p">)</span>
</span><span class='line'>        <span class="n">item</span>
</span><span class='line'>      <span class="k">end</span>
</span><span class='line'>    <span class="k">end</span><span class="o">.</span><span class="n">compact</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">invitee_list</span>
</span><span class='line'>    <span class="vi">@invitee_list</span> <span class="o">||=</span> <span class="vi">@invitees</span><span class="o">.</span><span class="n">gsub</span><span class="p">(</span><span class="sr">/\s+/</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="sr">/[\n,;]+/</span><span class="p">)</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">valid_message?</span>
</span><span class='line'>    <span class="vi">@message</span><span class="o">.</span><span class="n">present?</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">valid_invitees?</span>
</span><span class='line'>    <span class="n">invalid_invitees</span><span class="o">.</span><span class="n">empty?</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">create_invitation</span><span class="p">(</span><span class="n">email</span><span class="p">)</span>
</span><span class='line'>    <span class="no">Invitation</span><span class="o">.</span><span class="n">create</span><span class="p">(</span>
</span><span class='line'>      <span class="ss">casting</span><span class="p">:</span>       <span class="vi">@casting</span><span class="p">,</span>
</span><span class='line'>      <span class="ss">sender</span><span class="p">:</span>        <span class="vi">@sender</span><span class="p">,</span>
</span><span class='line'>      <span class="ss">invitee_email</span><span class="p">:</span> <span class="n">email</span><span class="p">,</span>
</span><span class='line'>      <span class="ss">status</span><span class="p">:</span>        <span class="s1">&#39;pending&#39;</span>
</span><span class='line'>    <span class="p">)</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>Ugly fella huh? Can you see how much nastyness is bundled in here? Of course I put a little cherry on top, but you will run into code like this sooner or later.  Let’s think about what responsibilities this <strong>CastingInviter</strong> class has to juggle.</p>

<ul>
<li>Delivering email</li>
<li>Checking for valid messages and email addresses</li>
<li>Getting rid of white space</li>
<li>Splitting email addresses on commas and semicolons</li>
</ul>


<p>Should all of this be dumped on a class which just wants to deliver a casting call via <strong>deliver</strong>? Certainly not! If your method of invitation changes you can expect to run into some <a href="https://en.wikipedia.org/wiki/Shotgun_surgery">Shotgun surgery</a>. CastingInviter doesn’t need to know most of these details. That’s more the responsibility of some class that is specialized in dealing with email related stuff. In the future, you’ll find many reasons to change your code in here as well.</p>

<h3>Extract Class</h3>

<p>So how should we deal with this? Often, extracting a class is a handy refactoring pattern that will present itself as a reasonable solution to such problems as big, convoluted classes—especially when the class in question deals with multiple responsibilities. Private methods are often good candidates to start with—and easy marks as well. Sometimes you’ll need to extract even more than one class from such a bad boy—just don’t do it all in one step. Once you find enough coherent meat that seems to belong into a specialized object of its own you can extract that functionality into a new class.</p>

<p>You create a new class and gradually move the functionality over—one by one. Move each method separately and rename them if you see a reason to. Then reference the new class in the orignal one and delegate the needed functionality. Good thing you have test coverage (hopefully!) that lets you check if things still work properly every step of the way. Aim at being able to reuse your extracted classes as well. Its easier to see how its done in action so lets read some code:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">class</span> <span class="nc">CastingInviter</span>
</span><span class='line'>
</span><span class='line'>  <span class="kp">attr_reader</span> <span class="ss">:message</span><span class="p">,</span> <span class="ss">:invitees</span><span class="p">,</span> <span class="ss">:casting</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="n">attributes</span> <span class="o">=</span> <span class="p">{})</span>
</span><span class='line'>    <span class="vi">@message</span>  <span class="o">=</span> <span class="n">attributes</span><span class="o">[</span><span class="ss">:message</span><span class="o">]</span>  <span class="o">||</span> <span class="s1">&#39;&#39;</span>
</span><span class='line'>    <span class="vi">@invitees</span> <span class="o">=</span> <span class="n">attributes</span><span class="o">[</span><span class="ss">:invitees</span><span class="o">]</span> <span class="o">||</span> <span class="s1">&#39;&#39;</span>
</span><span class='line'>    <span class="vi">@casting</span>  <span class="o">=</span> <span class="n">attributes</span><span class="o">[</span><span class="ss">:casting</span><span class="o">]</span>
</span><span class='line'>    <span class="vi">@sender</span>   <span class="o">=</span> <span class="n">attributes</span><span class="o">[</span><span class="ss">:sender</span><span class="o">]</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">valid?</span>
</span><span class='line'>    <span class="n">casting_email_handler</span><span class="o">.</span><span class="n">valid?</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">deliver</span>
</span><span class='line'>    <span class="n">casting_email_handler</span><span class="o">.</span><span class="n">deliver</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="kp">private</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">casting_email_handler</span>
</span><span class='line'>    <span class="vi">@casting_email_handler</span> <span class="o">=</span> <span class="no">CastingEmailHandler</span><span class="o">.</span><span class="n">new</span><span class="p">(</span>
</span><span class='line'>      <span class="ss">message</span><span class="p">:</span>  <span class="n">message</span><span class="p">,</span>
</span><span class='line'>      <span class="ss">invitees</span><span class="p">:</span> <span class="n">invitees</span><span class="p">,</span>
</span><span class='line'>      <span class="ss">casting</span><span class="p">:</span>  <span class="n">casting</span><span class="p">,</span>
</span><span class='line'>      <span class="ss">sender</span><span class="p">:</span>   <span class="vi">@sender</span>
</span><span class='line'>    <span class="p">)</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">class</span> <span class="nc">CastingEmailHandler</span>
</span><span class='line'>  <span class="no">EMAIL_REGEX</span> <span class="o">=</span> <span class="sr">/\A([^@\s]+)@((?:[-a-z0-9]+\.)+[a-z]{2,})\z/</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="kp">attr</span> <span class="o">=</span> <span class="p">{})</span>
</span><span class='line'>    <span class="vi">@message</span>  <span class="o">=</span> <span class="kp">attr</span><span class="o">[</span><span class="ss">:message</span><span class="o">]</span>  <span class="o">||</span> <span class="s1">&#39;&#39;</span>
</span><span class='line'>    <span class="vi">@invitees</span> <span class="o">=</span> <span class="kp">attr</span><span class="o">[</span><span class="ss">:invitees</span><span class="o">]</span> <span class="o">||</span> <span class="s1">&#39;&#39;</span>
</span><span class='line'>    <span class="vi">@casting</span>  <span class="o">=</span> <span class="kp">attr</span><span class="o">[</span><span class="ss">:casting</span><span class="o">]</span>
</span><span class='line'>    <span class="vi">@sender</span>   <span class="o">=</span> <span class="kp">attr</span><span class="o">[</span><span class="ss">:sender</span><span class="o">]</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">valid?</span>
</span><span class='line'>    <span class="n">valid_message?</span> <span class="o">&amp;&amp;</span> <span class="n">valid_invitees?</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">deliver</span>
</span><span class='line'>    <span class="k">if</span> <span class="n">valid?</span>
</span><span class='line'>      <span class="n">invitee_list</span><span class="o">.</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">email</span><span class="o">|</span>
</span><span class='line'>        <span class="n">invitation</span> <span class="o">=</span> <span class="n">create_invitation</span><span class="p">(</span><span class="n">email</span><span class="p">)</span>
</span><span class='line'>        <span class="no">Mailer</span><span class="o">.</span><span class="n">invitation_notification</span><span class="p">(</span><span class="n">invitation</span><span class="p">,</span> <span class="vi">@message</span><span class="p">)</span>
</span><span class='line'>      <span class="k">end</span>
</span><span class='line'>    <span class="k">else</span>
</span><span class='line'>      <span class="n">failure_message</span>  <span class="o">=</span> <span class="s2">&quot;Your </span><span class="si">#{</span> <span class="vi">@casting</span> <span class="si">}</span><span class="s2"> message couldn’t be sent. Invitees emails or message are invalid&quot;</span>
</span><span class='line'>      <span class="n">invitation</span> <span class="o">=</span> <span class="n">create_invitation</span><span class="p">(</span><span class="vi">@sender</span><span class="p">)</span>
</span><span class='line'>      <span class="no">Mailer</span><span class="o">.</span><span class="n">invitation_notification</span><span class="p">(</span><span class="n">invitation</span><span class="p">,</span> <span class="n">failure_message</span> <span class="p">)</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="kp">private</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">invalid_invitees</span>
</span><span class='line'>    <span class="vi">@invalid_invitees</span> <span class="o">||=</span> <span class="n">invitee_list</span><span class="o">.</span><span class="n">map</span> <span class="k">do</span> <span class="o">|</span><span class="n">item</span><span class="o">|</span>
</span><span class='line'>      <span class="k">unless</span> <span class="n">item</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="no">EMAIL_REGEX</span><span class="p">)</span>
</span><span class='line'>        <span class="n">item</span>
</span><span class='line'>      <span class="k">end</span>
</span><span class='line'>    <span class="k">end</span><span class="o">.</span><span class="n">compact</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">invitee_list</span>
</span><span class='line'>    <span class="vi">@invitee_list</span> <span class="o">||=</span> <span class="vi">@invitees</span><span class="o">.</span><span class="n">gsub</span><span class="p">(</span><span class="sr">/\s+/</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="sr">/[\n,;]+/</span><span class="p">)</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">valid_invitees?</span>
</span><span class='line'>    <span class="n">invalid_invitees</span><span class="o">.</span><span class="n">empty?</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">valid_message?</span>
</span><span class='line'>    <span class="vi">@message</span><span class="o">.</span><span class="n">present?</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">create_invitation</span><span class="p">(</span><span class="n">email</span><span class="p">)</span>
</span><span class='line'>    <span class="no">Invitation</span><span class="o">.</span><span class="n">create</span><span class="p">(</span>
</span><span class='line'>      <span class="ss">casting</span><span class="p">:</span>       <span class="vi">@casting</span><span class="p">,</span>
</span><span class='line'>      <span class="ss">sender</span><span class="p">:</span>        <span class="vi">@sender</span><span class="p">,</span>
</span><span class='line'>      <span class="ss">invitee_email</span><span class="p">:</span> <span class="n">email</span><span class="p">,</span>
</span><span class='line'>      <span class="ss">status</span><span class="p">:</span>        <span class="s1">&#39;pending&#39;</span>
</span><span class='line'>    <span class="p">)</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>In this solution, you’ll not only see how this separation of concerns affects your code quality, it also reads a lot better and becomes easier to digest. Here we delegate methods to a new class that is specialized in dealing with delivering these invitations via email. You have one dedicated place that checks if the messages and invitees are valid and how they need to be delivered. <strong>CastingInviter</strong> doesn’t need to know anything about these details so we delegate these responsibilities to a new class <strong>CastingEmailHandler</strong>.</p>

<p>The knowledge of how to deliver and check for validity of these casting invitation emails is now all contained in our new extracted class. Do we have more code now? You bet! Was it worth it to separate concerns? Pretty sure! Can we go beyond that and refactor <strong>CastingEmailHandler</strong> some more? Absolutely! Knock yourself out!</p>

<p>In case you’re wondering about the <strong>valid?</strong> method on <strong>CastingEmailHandler</strong> and <strong>CastingInviter</strong>. This one is for RSpec to create a custom matcher. This lets me write something like</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">expect</span><span class="p">(</span><span class="n">casting_inviter</span><span class="p">)</span><span class="o">.</span><span class="n">to</span> <span class="n">be_valid</span>
</span></code></pre></td></tr></table></div></figure>


<p>Pretty handy I think.</p>

<p>There are more techniques for dealing with large classes / god objects and over the course of this series you’ll learn a couple of ways to refactor such objects. There is no fixed prescription how you need to deal with these cases—it always depends and its a case-by-case judgement call if you need to bring the big guns or if smaller, incremental refactoring techniques oblige best. I know, a bit frustrating at times. Following the <a href="https://en.wikipedia.org/wiki/Single_responsibility_principle">Single Responsibility Principle</a> (SRP) will go a long way though and is a good nose to follow.</p>

<ul>
<li><h3>Long Method</h3></li>
</ul>


<p>Having methods that got a little big is one of the most common things you encounter as a developer. In general, you want to know at a glance what a method is supposed to do. It should also have only one level of nesting or one level of abstraction. In short, avoid to write complicated methods. I know this sounds hard and it often is. A solution that comes up frequently is extracting parts of the method into one or more new functions. This refactoring technique is called <strong>extract method</strong>—its one of the simplest but none the less very effective. As a nice side effect, your code becomes more readable if you name your methods appropriately.</p>

<p>Let’s take a look at feature specs where you’ll need this technique a lot. I remember getting introduced to <em>extract method</em> while writing such feature specs and how amazing it felt when the lightbulb went on. Because feature specs like this are easy to understand they are a good candiate for demonstration. Plus you’ll run into similar scenarios over and over when you write your specs.</p>

<p><strong>spec/features/some_feature_spec.rb</strong></p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="nb">require</span> <span class="s1">&#39;rails_helper&#39;</span>
</span><span class='line'>
</span><span class='line'><span class="n">feature</span> <span class="s1">&#39;M marks mission as complete&#39;</span> <span class="k">do</span>
</span><span class='line'>  <span class="n">scenario</span> <span class="s1">&#39;successfully&#39;</span> <span class="k">do</span>
</span><span class='line'>    <span class="n">visit_root_path</span>
</span><span class='line'>    <span class="n">fill_in</span>      <span class="s1">&#39;Email&#39;</span><span class="p">,</span> <span class="ss">with</span><span class="p">:</span> <span class="s1">&#39;M@mi6.com&#39;</span>
</span><span class='line'>    <span class="n">click_button</span> <span class="s1">&#39;Submit&#39;</span>
</span><span class='line'>    <span class="n">visit</span> <span class="n">missions_path</span>
</span><span class='line'>    <span class="n">click_on</span>     <span class="s1">&#39;Create Mission&#39;</span>
</span><span class='line'>    <span class="n">fill_in</span>      <span class="s1">&#39;Mission Name&#39;</span><span class="p">,</span> <span class="ss">with</span><span class="p">:</span> <span class="s1">&#39;Project Moonraker&#39;</span>
</span><span class='line'>    <span class="n">click_button</span> <span class="s1">&#39;Submit&#39;</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">within</span> <span class="s2">&quot;li:contains(&#39;Project Moonraker&#39;)&quot;</span> <span class="k">do</span>
</span><span class='line'>      <span class="n">click_on</span> <span class="s1">&#39;Mission completed&#39;</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">expect</span><span class="p">(</span><span class="n">page</span><span class="p">)</span><span class="o">.</span><span class="n">to</span> <span class="n">have_css</span> <span class="s1">&#39;ul.missions li.mission-name.completed&#39;</span><span class="p">,</span> <span class="ss">text</span><span class="p">:</span> <span class="s1">&#39;Project Moonraker&#39;</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>As you can easily see, there is a lot going on in this scenario. You go to the index page, sign in and create a mission for the setup, then exercise via marking the mission as complete and finally you verify the behaviour. No rocket science, but also not clean and definitely not composed for reuseability. We can do better than that:</p>

<p><strong>spec/features/some_feature_spec.rb</strong></p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="nb">require</span> <span class="s1">&#39;rails_helper&#39;</span>
</span><span class='line'>
</span><span class='line'><span class="n">feature</span> <span class="s1">&#39;M marks mission as complete&#39;</span> <span class="k">do</span>
</span><span class='line'>  <span class="n">scenario</span> <span class="s1">&#39;successfully&#39;</span> <span class="k">do</span>
</span><span class='line'>    <span class="n">sign_in_as</span> <span class="s1">&#39;M@mi6.com&#39;</span>
</span><span class='line'>    <span class="n">create_classified_mission_named</span> <span class="s1">&#39;Project Moonraker&#39;</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">mark_mission_as_complete</span>        <span class="s1">&#39;Project Moonraker&#39;</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">agent_sees_completed_mission</span>    <span class="s1">&#39;Project Moonraker&#39;</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="k">def</span> <span class="nf">create_classified_mission_named</span><span class="p">(</span><span class="n">mission_name</span><span class="p">)</span>
</span><span class='line'>  <span class="n">visit</span> <span class="n">missions_path</span>
</span><span class='line'>  <span class="n">click_on</span>     <span class="s1">&#39;Create Mission&#39;</span>
</span><span class='line'>  <span class="n">fill_in</span>      <span class="s1">&#39;Mission Name&#39;</span><span class="p">,</span> <span class="ss">with</span><span class="p">:</span> <span class="n">mission_name</span>
</span><span class='line'>  <span class="n">click_button</span> <span class="s1">&#39;Submit&#39;</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="k">def</span> <span class="nf">mark_mission_as_complete</span><span class="p">(</span><span class="n">mission_name</span><span class="p">)</span>
</span><span class='line'>  <span class="n">within</span> <span class="s2">&quot;li:contains(&#39;</span><span class="si">#{</span><span class="n">mission_name</span><span class="si">}</span><span class="s2">&#39;)&quot;</span> <span class="k">do</span>
</span><span class='line'>    <span class="n">click_on</span> <span class="s1">&#39;Mission completed&#39;</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="k">def</span> <span class="nf">agent_sees_completed_mission</span><span class="p">(</span><span class="n">mission_name</span><span class="p">)</span>
</span><span class='line'>  <span class="n">expect</span><span class="p">(</span><span class="n">page</span><span class="p">)</span><span class="o">.</span><span class="n">to</span> <span class="n">have_css</span> <span class="s1">&#39;ul.missions li.mission-name.completed&#39;</span><span class="p">,</span> <span class="ss">text</span><span class="p">:</span> <span class="n">mission_name</span>
</span><span class='line'><span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="k">def</span> <span class="nf">sign_in_as</span><span class="p">(</span><span class="n">email</span><span class="p">)</span>
</span><span class='line'>  <span class="n">visit</span> <span class="n">root_path</span>
</span><span class='line'>  <span class="n">fill_in</span>      <span class="s1">&#39;Email&#39;</span><span class="p">,</span> <span class="ss">with</span><span class="p">:</span> <span class="n">email</span>
</span><span class='line'>  <span class="n">click_button</span> <span class="s1">&#39;Submit&#39;</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>Here we extracted four methods that can be easily reused in other tests now. I hope its clear that we hit three birds with one stone. The feature is a lot more consise, it reads better and is made up of extracted components without duplication. Let’s imagine you’d have written all kinds of similar scenarios without extracting these methods and you want to change some implementation. Now you wish you’d taken the time to refactor your tests and have one central place to apply your changes.</p>

<p>Sure there is an even better way to deal with feature specs like this—Page Objects for example—but that’s not our scope for today. I guess that’s all you need to know about extracting methods. You can apply this refactoring pattern everywhere in your code—not only in specs of course. In terms of fequency of use, my guess is that it will be your number one technique to improve the quality of your code. Have fun!</p>

<ul>
<li><h3>Parameter Object</h3></li>
</ul>


<p>Let’s close this article with an example how you can slim down your parameters. It gets tedious pretty fast when you have to feed your methods more than one or two arguments. Wouldn’t it be nice to drop in one object instead? That’s exactly what you can do if you introduce a parameter object.</p>

<p>All these parameters are not only a pain to write and to keep in order, it can also lead to code duplication—and we certainly want to avoid that wherever possible. What I like especially about this refactoring technique is how this affects other methods inside as well. You often are able to get rid of a lot of parameter junk down in the foodchain as well.</p>

<p>Let’s go over this simple example. M can assign a new mission and needs needs a mission name, an agent, an objective and is also able to switch between double 0 status—meaning their licence to kill.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">class</span> <span class="nc">M</span>
</span><span class='line'>  <span class="k">def</span> <span class="nf">assign_new_mission</span><span class="p">(</span><span class="n">mission_name</span><span class="p">,</span> <span class="n">agent_name</span><span class="p">,</span> <span class="n">objective</span><span class="p">,</span> <span class="ss">licence_to_kill</span><span class="p">:</span> <span class="kp">nil</span><span class="p">)</span>
</span><span class='line'>    <span class="nb">print</span> <span class="s2">&quot;Mission </span><span class="si">#{</span><span class="n">mission_name</span><span class="si">}</span><span class="s2"> has been assigned to </span><span class="si">#{</span><span class="n">agent_name</span><span class="si">}</span><span class="s2"> with the objective to </span><span class="si">#{</span><span class="n">objective</span><span class="si">}</span><span class="s2">.&quot;</span>
</span><span class='line'>    <span class="k">if</span> <span class="n">licence_to_kill</span>
</span><span class='line'>      <span class="nb">print</span> <span class="s2">&quot; The licence to kill has been granted.&quot;</span>
</span><span class='line'>    <span class="k">else</span>
</span><span class='line'>      <span class="nb">print</span> <span class="s2">&quot;The licence to kill has not been granted.&quot;</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="n">m</span> <span class="o">=</span> <span class="n">M</span><span class="o">.</span><span class="n">new</span>
</span><span class='line'><span class="n">m</span><span class="o">.</span><span class="n">assign_new_mission</span><span class="p">(</span><span class="s1">&#39;Octopussy&#39;</span><span class="p">,</span> <span class="s1">&#39;James Bond&#39;</span><span class="p">,</span> <span class="s1">&#39;find the nuclear device&#39;</span><span class="p">,</span> <span class="ss">licence_to_kill</span><span class="p">:</span> <span class="kp">true</span><span class="p">)</span>
</span><span class='line'><span class="c1"># =&gt; Mission Octopussy has been assigned to James Bond with the objective to find the nuclear device. The licence to kill has been granted. </span>
</span></code></pre></td></tr></table></div></figure>


<p>When you look at this and ask what happens when the mission “parameters” grow in complexity then you’re already onto something. That’s a pain point that you can only solve if you pass in a single object that has all the information you need. More often than not, this also helps you to stay away from changing the method if the parameter object changes for some reason.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">class</span> <span class="nc">Mission</span>
</span><span class='line'>  <span class="kp">attr_reader</span> <span class="ss">:mission_name</span><span class="p">,</span> <span class="ss">:agent_name</span><span class="p">,</span> <span class="ss">:objective</span><span class="p">,</span> <span class="ss">:licence_to_kill</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="ss">mission_name</span><span class="p">:</span> <span class="n">mission_name</span><span class="p">,</span> <span class="ss">agent_name</span><span class="p">:</span> <span class="n">agent_name</span><span class="p">,</span> <span class="ss">objective</span><span class="p">:</span> <span class="n">objective</span><span class="p">,</span> <span class="ss">licence_to_kill</span><span class="p">:</span> <span class="n">licence_to_kill</span><span class="p">)</span>
</span><span class='line'>    <span class="vi">@mission_name</span>    <span class="o">=</span> <span class="n">mission_name</span>
</span><span class='line'>    <span class="vi">@agent_name</span>      <span class="o">=</span> <span class="n">agent_name</span>
</span><span class='line'>    <span class="vi">@objective</span>       <span class="o">=</span> <span class="n">objective</span>
</span><span class='line'>    <span class="vi">@licence_to_kill</span> <span class="o">=</span> <span class="n">licence_to_kill</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">assign</span>
</span><span class='line'>    <span class="nb">print</span> <span class="s2">&quot;Mission </span><span class="si">#{</span><span class="n">mission_name</span><span class="si">}</span><span class="s2"> has been assigned to </span><span class="si">#{</span><span class="n">agent_name</span><span class="si">}</span><span class="s2"> with the objective to </span><span class="si">#{</span><span class="n">objective</span><span class="si">}</span><span class="s2">.&quot;</span>
</span><span class='line'>    <span class="k">if</span> <span class="n">licence_to_kill</span>
</span><span class='line'>      <span class="nb">print</span> <span class="s2">&quot; The licence to kill has been granted.&quot;</span>
</span><span class='line'>    <span class="k">else</span>
</span><span class='line'>      <span class="nb">print</span> <span class="s2">&quot; The licence to kill has not been granted.&quot;</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="k">class</span> <span class="nc">M</span>
</span><span class='line'>  <span class="k">def</span> <span class="nf">assign_new_mission</span><span class="p">(</span><span class="n">mission</span><span class="p">)</span>
</span><span class='line'>    <span class="n">mission</span><span class="o">.</span><span class="n">assign</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="n">m</span> <span class="o">=</span> <span class="n">M</span><span class="o">.</span><span class="n">new</span>
</span><span class='line'><span class="n">mission</span> <span class="o">=</span> <span class="no">Mission</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="ss">mission_name</span><span class="p">:</span> <span class="s1">&#39;Octopussy&#39;</span><span class="p">,</span> <span class="ss">agent_name</span><span class="p">:</span> <span class="s1">&#39;James Bond&#39;</span><span class="p">,</span> <span class="ss">objective</span><span class="p">:</span> <span class="s1">&#39;find the nuclear device&#39;</span><span class="p">,</span> <span class="ss">licence_to_kill</span><span class="p">:</span> <span class="kp">true</span><span class="p">)</span>
</span><span class='line'><span class="n">m</span><span class="o">.</span><span class="n">assign_new_mission</span><span class="p">(</span><span class="n">mission</span><span class="p">)</span>
</span><span class='line'><span class="c1"># =&gt; Mission Octopussy has been assigned to James Bond with the objective to find the nuclear device. The licence to kill has been granted.</span>
</span></code></pre></td></tr></table></div></figure>


<p>So we created a new object, <strong>Mission</strong>, that is soley focused on providing <strong>M</strong> with the information needed to assign a new mission and provide #<strong>assign_new_mission</strong> with a singular paramter object. No need to pass in these pesky parameters yourself. Instead you tell the object to reveal the information you need inside the method itself. Additionally, we also extracted some behaviour—the information how to print—into the new <strong>Mission</strong> object.</p>

<p>Why should <strong>M</strong> need to know about how to print mission assignments? The new #<strong>assign</strong> also benefitted from extraction by loosing some weight because we didn’t need to pass in the parameter object—so no need to write stuff like <strong>mission.mission_name</strong>, <strong>mission.agent_name</strong> and so on. Now we just use our <strong>attr_reader</strong>(s) which is much cleaner than without the extraction. You dig? What’s also handy about this is that <strong>Mission</strong> might collect all sorts of additional methods or states that are nicely encapsulated in one place and ready for you to access.</p>

<p>With this technique you’ll end up with methods that are more concise, they tend to read better and you avoid repeating the same group of parameters all over the place. Pretty good deal! Getting rid of identical groups of parameters is also an important strategy for DRY code. Try to look out for extracting more than just your data. If you can place behaviour in the new class as well you’ll have objects that are more useful—otherwise they’ll quickly start to smell as well.</p>

<p>Sure, most of the time you’ll run into more complicated versions of that—and your tests will certainly also need to be adapted simultaneously during such refactorings—but if you have that simple example under your belt you’ll be ready for action.</p>

<p>I’m gonna watch the new Bond now. Heard its not that good though…
Update: Saw Spectre. My verdict: compared to Skyfall—which was MEH imho—Spectre was wawawiwa!</p>
</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">Your Name</span></span>

      




<time class='entry-date' datetime='2015-11-05T04:29:10+01:00'><span class='date'><span class='date-month'>Nov</span> <span class='date-day'>5</span><span class='date-suffix'>th</span>, <span class='date-year'>2015</span></span> <span class='time'>4:29 am</span></time>
      

<span class="categories">
  
    <a class='category' href='/octopress_drafts_previewer/blog/categories/bdd/'>bdd</a>, <a class='category' href='/octopress_drafts_previewer/blog/categories/factory-girl/'>factory girl</a>, <a class='category' href='/octopress_drafts_previewer/blog/categories/rails/'>rails</a>, <a class='category' href='/octopress_drafts_previewer/blog/categories/rspec/'>rspec</a>, <a class='category' href='/octopress_drafts_previewer/blog/categories/ruby/'>ruby</a>, <a class='category' href='/octopress_drafts_previewer/blog/categories/tdd/'>tdd</a>, <a class='category' href='/octopress_drafts_previewer/blog/categories/test-driven-design/'>test-driven-design</a>, <a class='category' href='/octopress_drafts_previewer/blog/categories/thoughtbot/'>thoughtbot</a>
  
</span>


    </p>
    
      <div class="sharing">
  
  <a href="//twitter.com/share" class="twitter-share-button" data-url="http://vis-kid.github.io/octopress_drafts_previewer/blog/2015/11/05/Code-Smells-01/" data-via="" data-counturl="http://vis-kid.github.io/octopress_drafts_previewer/blog/2015/11/05/Code-Smells-01/" >Tweet</a>
  
  
  
</div>

    
    <p class="meta">
      
      
        <a class="basic-alignment right" href="/octopress_drafts_previewer/blog/2015/11/05/Middleman-01/" title="Next Post: Middleman Basics 01">Middleman Basics 01 &raquo;</a>
      
    </p>
  </footer>
</article>

</div>

<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/octopress_drafts_previewer/blog/2015/11/05/Middleman-01/">Middleman Basics 01</a>
      </li>
    
      <li class="post">
        <a href="/octopress_drafts_previewer/blog/2015/11/05/Code-Smells-01/">Ruby / Rails Code Smells 01</a>
      </li>
    
  </ul>
</section>





  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2015 - Your Name -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  







  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = '//platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
